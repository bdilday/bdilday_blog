<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Closeness Index - One-run games&#43;&#43; | graphswithcodeanddata</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
    <header>

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <nav>
    <ul>
      
      
      <li class="pull-left ">
        <a href="/">/home/graphswithcodeanddata</a>
      </li>
      
      
      <li class="pull-left ">
        <a href="/about/">~/about</a>
      </li>
      
      
      <li class="pull-left ">
        <a href="https://github.com/rstudio/blogdown">~/github</a>
      </li>
      
      
      <li class="pull-left ">
        <a href="https://twitter.com/GraphsWithCode">~/twitter</a>
      </li>
      

      

    </ul>
  </nav>
</header>

  </head>

  <body>
    <br/>

<div class="article-meta">
<h1><span class="title">Closeness Index - One-run games&#43;&#43;</span></h1>

<h2 class="date">2018/06/17</h2>
<p class="terms">
  
  
  
  
  
</p>
</div>



<main>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>The <a href="../../../../2018/06/15/record-in-one-run-games/">last post</a> looked at records in one-run games. It turns out that <a href="http://www.baseballmusings.com/?p=48169">Baseball Musings</a> offered a alternative way of thinking about it some 8 years ago. The overarching idea here is that one-run games are kind of a proxy for tight games - but there’s a difference between a game that’s not close, and then the bullpen blows a lead and it ends up at 1-run, versus a game that’s close the whole way. The second type is qualitatively different and tells us more about how strategy might factor in.</p>
<p>To reemphasize what the technical idea is, you compute a closeness index for a game by taking the average of the absolute value of the score differential at the end of each half inning. So there’s a lower limit for a regulation 9-inning game of 1/18 = 0.056, i.e. when it’s tied the entire game up until the bottom of the ninth and then the home team wins it by one.</p>
<p>This post will use this definition for closeness index and do some exploratory analysis.</p>
</div>
<div id="libraries" class="section level2">
<h2>libraries</h2>
<pre class="r"><code>library(RPostgres)
library(DBI)
library(dplyr)
library(ggplot2)
library(ggrepel)</code></pre>
</div>
<div id="data" class="section level2">
<h2>data</h2>
<p>I’ll use the retrosheet event-level data. This is overkill in a way since I only need scores at the end of half-innings, but it’s the best way I know how to get that.</p>
<p>In the post where Baseball Musings introduced closeness, he looked exclusively at 1974+, where the records are 100% complete. I’m going to look at 1955+ since I’m looking mainly for outliers and overall trends and am not overly concerned with completeness - I generally believe the maxim of don’t let the perfect be the enemy of the good.</p>
<p>Connect to the database</p>
<pre class="r"><code>conn &lt;- dbConnect(RPostgres::Postgres(), 
                  password=Sys.getenv(&quot;PSQL_PASS&quot;), 
                  user=Sys.getenv(&quot;PSQL_USER&quot;), 
                  port=Sys.getenv(&quot;PSQL_PORT&quot;), 
                  dbname=&#39;retrosheet&#39;)</code></pre>
<p>Grab data since 1955, filtering to only include end of innings</p>
<pre class="r"><code>  ev = dbGetQuery(conn, &quot;select * from event where year_id &gt; 1954 and inn_end_fl = \&#39;t\&#39;&quot;)</code></pre>
<div id="closeness-per-inning" class="section level3">
<h3>closeness per inning</h3>
<p>This function processes the data to:</p>
<ul>
<li><p>figure out the score at each half-inning</p></li>
<li><p>make a duplicate of each record so that there is a row for the home team as “the team” and the away team as “the opponent”, and visa versa</p></li>
<li><p>add a column for “closeness_idx”, the score differential at the half-inning</p></li>
</ul>
<pre class="r"><code>process_data = function(ev) {
  ev2 = ev %&gt;% 
    mutate(home_score = home_score_ct + ifelse(bat_home_id==1, event_runs_ct, 0), 
           away_score = away_score_ct + ifelse(bat_home_id==0, event_runs_ct, 0))
  evA = ev2 %&gt;% 
    select(game_id, inn_ct, year_id, bat_home_id, 
           team_id=home_team_id, opp_id=away_team_id, 
           team_score=home_score, opp_score=away_score)
  evH = ev2 %&gt;% 
    select(game_id, inn_ct, year_id, bat_home_id,
           team_id=away_team_id, opp_id=home_team_id, 
           team_score=away_score, opp_score=home_score)
  
  evX = dplyr::bind_rows(evA, evH) %&gt;% 
    mutate(close_idx = abs(team_score - opp_score))

}</code></pre>
<p>Process the event data</p>
<pre class="r"><code>evX = process_data(ev)</code></pre>
</div>
<div id="closeness-per-game" class="section level3">
<h3>closeness per game</h3>
<p>This function groups the half-inning data by game, adding a column to indicate which team won.</p>
<pre class="r"><code>get_wins = function(evX) {
  win_df = evX %&gt;% 
    group_by(game_id) %&gt;% 
    mutate(mx = max(inn_ct)) %&gt;% 
    filter(inn_ct==mx) %&gt;% 
    arrange(-bat_home_id) %&gt;% 
    mutate(ridx= row_number()) %&gt;% 
    filter(ridx &lt;= 2) %&gt;% mutate(is_win= team_score &gt; opp_score) %&gt;% 
    select(game_id, team_id, is_win)
  
  win_df %&gt;% inner_join(evX, by=c(&quot;game_id&quot;, &quot;team_id&quot;)) %&gt;% 
    group_by(game_id, year_id, team_id) %&gt;% 
    mutate(closeness_score=mean(close_idx)) %&gt;% ungroup()
}</code></pre>
<pre class="r"><code>ev_win_df = get_wins(evX)
ev_win_df %&gt;% head(3) %&gt;% as.data.frame()</code></pre>
<pre><code>##        game_id team_id is_win inn_ct year_id bat_home_id opp_id team_score
## 1 WS1195509210     WS1  FALSE      9    1955           1    NYA          3
## 2 WS1195509210     WS1  FALSE      9    1955           0    NYA          3
## 3 WS1195509210     WS1  FALSE      8    1955           1    NYA          3
##   opp_score close_idx closeness_score
## 1         7         4        4.388889
## 2         7         4        4.388889
## 3         7         4        4.388889</code></pre>
<p>Aggregate by game, computing the closeness index as the mean absolute value of the score differential</p>
<pre class="r"><code>game_win_df = ev_win_df %&gt;% 
  group_by(game_id, team_id, is_win, year_id) %&gt;% 
  summarise(closeness_idx=mean(close_idx)) %&gt;% 
  ungroup()
game_win_df %&gt;% head(3) %&gt;% as.data.frame()</code></pre>
<pre><code>##        game_id team_id is_win year_id closeness_idx
## 1 ANA199704020     ANA  FALSE    1997     1.7222222
## 2 ANA199704020     BOS   TRUE    1997     1.7222222
## 3 ANA199704030     ANA   TRUE    1997     0.3529412</code></pre>
</div>
</div>
<div id="exploratory-analysis" class="section level2">
<h2>exploratory analysis</h2>
<p>The distribution of closeness index</p>
<pre class="r"><code>p = game_win_df %&gt;% ggplot(aes(x=closeness_idx)) + 
  geom_histogram(binwidth = 0.5) + 
  theme_minimal(base_size = 16)
print(p)</code></pre>
<p><img src="/post/2018-06-17-closeness-index-one-run-games_files/figure-html/unnamed-chunk-9-1.png" width="768" /></p>
<div id="the-most-close-games" class="section level3">
<h3>the “most close” games</h3>
<p>This collapses the per-game closeness (one record for each team) into one record per game, and orders them by closeness index. The <code>game_id</code> can be copy pasted to look up the game on baseball reference, e.g., <a href="https://www.baseball-reference.com/boxes/BAL/BAL195705192.shtml">BAL195705192</a></p>
<pre class="r"><code>game_win_df %&gt;% group_by(game_id) %&gt;% 
  summarise(closeness_idx=mean(closeness_idx)) %&gt;%
  arrange(closeness_idx) %&gt;% 
  filter(closeness_idx &lt; 0.032) %&gt;% 
  knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">game_id</th>
<th align="right">closeness_idx</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">BAL195705192</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">CHN195608122</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">NYN196510022</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">SLN198909130</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">HOU196804150</td>
<td align="right">0.0208333</td>
</tr>
<tr class="even">
<td align="left">OAK197107090</td>
<td align="right">0.0250000</td>
</tr>
<tr class="odd">
<td align="left">BAL197409270</td>
<td align="right">0.0294118</td>
</tr>
<tr class="even">
<td align="left">CHA196709130</td>
<td align="right">0.0294118</td>
</tr>
<tr class="odd">
<td align="left">HOU198008230</td>
<td align="right">0.0294118</td>
</tr>
<tr class="even">
<td align="left">MON198109210</td>
<td align="right">0.0294118</td>
</tr>
<tr class="odd">
<td align="left">NYN199309290</td>
<td align="right">0.0294118</td>
</tr>
<tr class="even">
<td align="left">BAL195909112</td>
<td align="right">0.0312500</td>
</tr>
<tr class="odd">
<td align="left">CHN200305310</td>
<td align="right">0.0312500</td>
</tr>
<tr class="even">
<td align="left">HOU197604210</td>
<td align="right">0.0312500</td>
</tr>
<tr class="odd">
<td align="left">PHI199105170</td>
<td align="right">0.0312500</td>
</tr>
<tr class="even">
<td align="left">SFN196307020</td>
<td align="right">0.0312500</td>
</tr>
</tbody>
</table>
</div>
<div id="the-least-close-games" class="section level3">
<h3>the “least close” games</h3>
<p>Same for the highest closeness indexes, i.e. the “least close” games</p>
<pre class="r"><code>game_win_df %&gt;% group_by(game_id) %&gt;% 
  summarise(closeness_idx=mean(closeness_idx)) %&gt;%
  arrange(-closeness_idx) %&gt;% 
  filter(closeness_idx &gt; 12.6) %&gt;% 
  knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">game_id</th>
<th align="right">closeness_idx</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">CHN197509160</td>
<td align="right">16.11111</td>
</tr>
<tr class="even">
<td align="left">TOR197908250</td>
<td align="right">15.66667</td>
</tr>
<tr class="odd">
<td align="left">DET200409091</td>
<td align="right">15.61111</td>
</tr>
<tr class="even">
<td align="left">BOS200306270</td>
<td align="right">14.58824</td>
</tr>
<tr class="odd">
<td align="left">NYA200904180</td>
<td align="right">14.00000</td>
</tr>
<tr class="even">
<td align="left">KC1195504230</td>
<td align="right">13.66667</td>
</tr>
<tr class="odd">
<td align="left">SLN196108030</td>
<td align="right">13.55556</td>
</tr>
<tr class="even">
<td align="left">BAL200009280</td>
<td align="right">13.47059</td>
</tr>
<tr class="odd">
<td align="left">NYA201107302</td>
<td align="right">13.47059</td>
</tr>
<tr class="even">
<td align="left">PHI198506110</td>
<td align="right">13.23529</td>
</tr>
<tr class="odd">
<td align="left">MIN198207150</td>
<td align="right">13.22222</td>
</tr>
<tr class="even">
<td align="left">BOS199906260</td>
<td align="right">13.11765</td>
</tr>
<tr class="odd">
<td align="left">PHI200907060</td>
<td align="right">13.11765</td>
</tr>
<tr class="even">
<td align="left">KCA200609230</td>
<td align="right">13.00000</td>
</tr>
<tr class="odd">
<td align="left">KCA200006180</td>
<td align="right">12.94444</td>
</tr>
<tr class="even">
<td align="left">COL200509200</td>
<td align="right">12.88235</td>
</tr>
<tr class="odd">
<td align="left">SDN196906280</td>
<td align="right">12.77778</td>
</tr>
<tr class="even">
<td align="left">NYA200006180</td>
<td align="right">12.66667</td>
</tr>
<tr class="odd">
<td align="left">ATL199906130</td>
<td align="right">12.61111</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="seasonal-trends" class="section level2">
<h2>seasonal trends</h2>
<p>Anecdotally based on the tables above, the close games tend to come from low-scoring seasons and the least close ones from high-scoring seasons. This highlights the fairly self-evident fact that score differential, and hence closeness, depends on the run environment. This shows the closeness index by season, averaged over all games in a season.</p>
<pre class="r"><code>p = game_win_df %&gt;% group_by(year_id) %&gt;% 
  summarise(closeness_idx = mean(closeness_idx)) %&gt;% 
  ggplot(aes(x=year_id, y=closeness_idx)) + 
  geom_point(size=0.5) + 
  geom_line() + theme_minimal(base_size = 16)
print(p)</code></pre>
<p><img src="/post/2018-06-17-closeness-index-one-run-games_files/figure-html/unnamed-chunk-12-1.png" width="768" /></p>
</div>
<div id="team-records" class="section level2">
<h2>Team Records</h2>
<div id="fracvtio-of-one-run-games" class="section level3">
<h3>fracvtio of one-run games</h3>
<p>The ultimate goal of this analysis was to look at records in close games, as an analogy to the records in one-run games analyses. To do that, we need to account for the run environment, as shown above. To get an idea of how many games we should consider close and where to set the cutoff, this shows the fraction of all games that are one-run games.</p>
<pre class="r"><code>p = ev_win_df %&gt;% 
  group_by(game_id, year_id, team_id) %&gt;% 
  summarise(team_score=max(team_score), 
            opp_score = max(opp_score)) %&gt;%
  ungroup() %&gt;% 
  mutate(is1 = abs(team_score - opp_score) == 1) %&gt;% 
  group_by(year_id) %&gt;% 
  summarise(frac1 = mean(is1)) %&gt;% 
  ggplot(aes(x=year_id, y=frac1)) + 
  geom_line() + theme_minimal(base_size = 16)
print(p)</code></pre>
<p><img src="/post/2018-06-17-closeness-index-one-run-games_files/figure-html/unnamed-chunk-13-1.png" width="768" /></p>
<p>We see that historically “one-run games” occur something like 30% of the time. Here I take the lowest 30% of closeness index as definition of “close games” and see which teams had the most wins and highest win percentage</p>
<p>First define a function to change the definition and output tables of most wins and highest win percentage</p>
<pre class="r"><code>close_wins_tables = function(game_wins_df, close_definition, nteam=15) {

  close_percentile_df = game_wins_df %&gt;% 
    mutate(dummy=1) %&gt;% 
    group_by(year_id) %&gt;% 
    arrange(year_id, closeness_idx) %&gt;% 
    mutate(running = cumsum(dummy), n=n(), c_frac=running / n) %&gt;%
    ungroup() %&gt;% 
    mutate(is_close = c_frac &lt;= close_definition) %&gt;% 
    group_by(year_id, team_id) %&gt;% 
    summarise(w=sum(is_win), g=n(), 
              w_close = sum(is_close * is_win), 
              g_close = sum(is_close), 
              wpct_close = w_close/g_close) 
  
  list(w_table = 
         close_percentile_df %&gt;% 
         arrange(-w_close) %&gt;% 
         head(nteam),
       wpct_table = 
         close_percentile_df %&gt;% 
         arrange(-wpct_close) %&gt;% 
         head(nteam)
       )

}</code></pre>
<p>With the general function defined, try using the 30% closest games for each season</p>
<pre class="r"><code>close_definition = 0.3
tables = close_wins_tables(game_win_df, close_definition)
# ordered by wins
knitr::kable(tables$w_table)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">year_id</th>
<th align="left">team_id</th>
<th align="right">w</th>
<th align="right">g</th>
<th align="right">w_close</th>
<th align="right">g_close</th>
<th align="right">wpct_close</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1969</td>
<td align="left">NYN</td>
<td align="right">100</td>
<td align="right">162</td>
<td align="right">42</td>
<td align="right">60</td>
<td align="right">0.7000000</td>
</tr>
<tr class="even">
<td align="right">1959</td>
<td align="left">CHA</td>
<td align="right">94</td>
<td align="right">156</td>
<td align="right">40</td>
<td align="right">56</td>
<td align="right">0.7142857</td>
</tr>
<tr class="odd">
<td align="right">1992</td>
<td align="left">PIT</td>
<td align="right">96</td>
<td align="right">162</td>
<td align="right">40</td>
<td align="right">60</td>
<td align="right">0.6666667</td>
</tr>
<tr class="even">
<td align="right">2002</td>
<td align="left">LAN</td>
<td align="right">92</td>
<td align="right">162</td>
<td align="right">40</td>
<td align="right">61</td>
<td align="right">0.6557377</td>
</tr>
<tr class="odd">
<td align="right">2011</td>
<td align="left">SFN</td>
<td align="right">86</td>
<td align="right">162</td>
<td align="right">40</td>
<td align="right">70</td>
<td align="right">0.5714286</td>
</tr>
<tr class="even">
<td align="right">1999</td>
<td align="left">ATL</td>
<td align="right">103</td>
<td align="right">162</td>
<td align="right">39</td>
<td align="right">56</td>
<td align="right">0.6964286</td>
</tr>
<tr class="odd">
<td align="right">2003</td>
<td align="left">LAN</td>
<td align="right">85</td>
<td align="right">162</td>
<td align="right">39</td>
<td align="right">71</td>
<td align="right">0.5492958</td>
</tr>
<tr class="even">
<td align="right">1993</td>
<td align="left">ATL</td>
<td align="right">104</td>
<td align="right">162</td>
<td align="right">38</td>
<td align="right">60</td>
<td align="right">0.6333333</td>
</tr>
<tr class="odd">
<td align="right">2015</td>
<td align="left">SLN</td>
<td align="right">100</td>
<td align="right">162</td>
<td align="right">38</td>
<td align="right">66</td>
<td align="right">0.5757576</td>
</tr>
<tr class="even">
<td align="right">2016</td>
<td align="left">SFN</td>
<td align="right">87</td>
<td align="right">162</td>
<td align="right">38</td>
<td align="right">63</td>
<td align="right">0.6031746</td>
</tr>
<tr class="odd">
<td align="right">1965</td>
<td align="left">LAN</td>
<td align="right">97</td>
<td align="right">162</td>
<td align="right">37</td>
<td align="right">68</td>
<td align="right">0.5441176</td>
</tr>
<tr class="even">
<td align="right">1966</td>
<td align="left">LAN</td>
<td align="right">95</td>
<td align="right">162</td>
<td align="right">37</td>
<td align="right">59</td>
<td align="right">0.6271186</td>
</tr>
<tr class="odd">
<td align="right">1977</td>
<td align="left">BAL</td>
<td align="right">97</td>
<td align="right">161</td>
<td align="right">37</td>
<td align="right">52</td>
<td align="right">0.7115385</td>
</tr>
<tr class="even">
<td align="right">1995</td>
<td align="left">ATL</td>
<td align="right">90</td>
<td align="right">144</td>
<td align="right">37</td>
<td align="right">59</td>
<td align="right">0.6271186</td>
</tr>
<tr class="odd">
<td align="right">2008</td>
<td align="left">ANA</td>
<td align="right">100</td>
<td align="right">162</td>
<td align="right">37</td>
<td align="right">58</td>
<td align="right">0.6379310</td>
</tr>
</tbody>
</table>
<pre class="r"><code># ordered by win percentage
knitr::kable(tables$wpct_table)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">year_id</th>
<th align="left">team_id</th>
<th align="right">w</th>
<th align="right">g</th>
<th align="right">w_close</th>
<th align="right">g_close</th>
<th align="right">wpct_close</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2009</td>
<td align="left">NYA</td>
<td align="right">103</td>
<td align="right">162</td>
<td align="right">37</td>
<td align="right">48</td>
<td align="right">0.7708333</td>
</tr>
<tr class="even">
<td align="right">1961</td>
<td align="left">LAN</td>
<td align="right">89</td>
<td align="right">154</td>
<td align="right">32</td>
<td align="right">43</td>
<td align="right">0.7441860</td>
</tr>
<tr class="odd">
<td align="right">1995</td>
<td align="left">CLE</td>
<td align="right">100</td>
<td align="right">144</td>
<td align="right">34</td>
<td align="right">46</td>
<td align="right">0.7391304</td>
</tr>
<tr class="even">
<td align="right">2007</td>
<td align="left">NYN</td>
<td align="right">88</td>
<td align="right">162</td>
<td align="right">29</td>
<td align="right">40</td>
<td align="right">0.7250000</td>
</tr>
<tr class="odd">
<td align="right">1956</td>
<td align="left">BOS</td>
<td align="right">83</td>
<td align="right">152</td>
<td align="right">30</td>
<td align="right">42</td>
<td align="right">0.7142857</td>
</tr>
<tr class="even">
<td align="right">1959</td>
<td align="left">CHA</td>
<td align="right">94</td>
<td align="right">156</td>
<td align="right">40</td>
<td align="right">56</td>
<td align="right">0.7142857</td>
</tr>
<tr class="odd">
<td align="right">1977</td>
<td align="left">BAL</td>
<td align="right">97</td>
<td align="right">161</td>
<td align="right">37</td>
<td align="right">52</td>
<td align="right">0.7115385</td>
</tr>
<tr class="even">
<td align="right">1999</td>
<td align="left">TEX</td>
<td align="right">95</td>
<td align="right">162</td>
<td align="right">27</td>
<td align="right">38</td>
<td align="right">0.7105263</td>
</tr>
<tr class="odd">
<td align="right">1961</td>
<td align="left">CIN</td>
<td align="right">93</td>
<td align="right">154</td>
<td align="right">29</td>
<td align="right">41</td>
<td align="right">0.7073171</td>
</tr>
<tr class="even">
<td align="right">1995</td>
<td align="left">BOS</td>
<td align="right">86</td>
<td align="right">144</td>
<td align="right">29</td>
<td align="right">41</td>
<td align="right">0.7073171</td>
</tr>
<tr class="odd">
<td align="right">1998</td>
<td align="left">NYA</td>
<td align="right">114</td>
<td align="right">162</td>
<td align="right">29</td>
<td align="right">41</td>
<td align="right">0.7073171</td>
</tr>
<tr class="even">
<td align="right">2012</td>
<td align="left">OAK</td>
<td align="right">94</td>
<td align="right">162</td>
<td align="right">36</td>
<td align="right">51</td>
<td align="right">0.7058824</td>
</tr>
<tr class="odd">
<td align="right">1963</td>
<td align="left">LAN</td>
<td align="right">99</td>
<td align="right">163</td>
<td align="right">35</td>
<td align="right">50</td>
<td align="right">0.7000000</td>
</tr>
<tr class="even">
<td align="right">1969</td>
<td align="left">NYN</td>
<td align="right">100</td>
<td align="right">162</td>
<td align="right">42</td>
<td align="right">60</td>
<td align="right">0.7000000</td>
</tr>
<tr class="odd">
<td align="right">2012</td>
<td align="left">BAL</td>
<td align="right">93</td>
<td align="right">162</td>
<td align="right">37</td>
<td align="right">53</td>
<td align="right">0.6981132</td>
</tr>
</tbody>
</table>
<p>Let’s tighten that up to 20th percentile</p>
<pre class="r"><code>close_definition = 0.2
tables = close_wins_tables(game_win_df, close_definition)
knitr::kable(tables$w_table)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">year_id</th>
<th align="left">team_id</th>
<th align="right">w</th>
<th align="right">g</th>
<th align="right">w_close</th>
<th align="right">g_close</th>
<th align="right">wpct_close</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2011</td>
<td align="left">SFN</td>
<td align="right">86</td>
<td align="right">162</td>
<td align="right">32</td>
<td align="right">52</td>
<td align="right">0.6153846</td>
</tr>
<tr class="even">
<td align="right">1969</td>
<td align="left">NYN</td>
<td align="right">100</td>
<td align="right">162</td>
<td align="right">31</td>
<td align="right">43</td>
<td align="right">0.7209302</td>
</tr>
<tr class="odd">
<td align="right">1968</td>
<td align="left">SLN</td>
<td align="right">97</td>
<td align="right">162</td>
<td align="right">29</td>
<td align="right">40</td>
<td align="right">0.7250000</td>
</tr>
<tr class="even">
<td align="right">2003</td>
<td align="left">LAN</td>
<td align="right">85</td>
<td align="right">162</td>
<td align="right">29</td>
<td align="right">52</td>
<td align="right">0.5576923</td>
</tr>
<tr class="odd">
<td align="right">2012</td>
<td align="left">BAL</td>
<td align="right">93</td>
<td align="right">162</td>
<td align="right">29</td>
<td align="right">37</td>
<td align="right">0.7837838</td>
</tr>
<tr class="even">
<td align="right">2016</td>
<td align="left">SFN</td>
<td align="right">87</td>
<td align="right">162</td>
<td align="right">29</td>
<td align="right">48</td>
<td align="right">0.6041667</td>
</tr>
<tr class="odd">
<td align="right">1959</td>
<td align="left">CHA</td>
<td align="right">94</td>
<td align="right">156</td>
<td align="right">28</td>
<td align="right">39</td>
<td align="right">0.7179487</td>
</tr>
<tr class="even">
<td align="right">1985</td>
<td align="left">NYN</td>
<td align="right">98</td>
<td align="right">162</td>
<td align="right">28</td>
<td align="right">48</td>
<td align="right">0.5833333</td>
</tr>
<tr class="odd">
<td align="right">1993</td>
<td align="left">SLN</td>
<td align="right">87</td>
<td align="right">162</td>
<td align="right">28</td>
<td align="right">49</td>
<td align="right">0.5714286</td>
</tr>
<tr class="even">
<td align="right">1999</td>
<td align="left">ATL</td>
<td align="right">103</td>
<td align="right">162</td>
<td align="right">28</td>
<td align="right">38</td>
<td align="right">0.7368421</td>
</tr>
<tr class="odd">
<td align="right">2011</td>
<td align="left">WAS</td>
<td align="right">80</td>
<td align="right">161</td>
<td align="right">28</td>
<td align="right">44</td>
<td align="right">0.6363636</td>
</tr>
<tr class="even">
<td align="right">1963</td>
<td align="left">HOU</td>
<td align="right">66</td>
<td align="right">162</td>
<td align="right">27</td>
<td align="right">45</td>
<td align="right">0.6000000</td>
</tr>
<tr class="odd">
<td align="right">1975</td>
<td align="left">SFN</td>
<td align="right">80</td>
<td align="right">161</td>
<td align="right">27</td>
<td align="right">40</td>
<td align="right">0.6750000</td>
</tr>
<tr class="even">
<td align="right">1993</td>
<td align="left">MON</td>
<td align="right">94</td>
<td align="right">163</td>
<td align="right">27</td>
<td align="right">46</td>
<td align="right">0.5869565</td>
</tr>
<tr class="odd">
<td align="right">2004</td>
<td align="left">MIN</td>
<td align="right">92</td>
<td align="right">162</td>
<td align="right">27</td>
<td align="right">42</td>
<td align="right">0.6428571</td>
</tr>
</tbody>
</table>
<pre class="r"><code>knitr::kable(tables$wpct_table)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">year_id</th>
<th align="left">team_id</th>
<th align="right">w</th>
<th align="right">g</th>
<th align="right">w_close</th>
<th align="right">g_close</th>
<th align="right">wpct_close</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1999</td>
<td align="left">TEX</td>
<td align="right">95</td>
<td align="right">162</td>
<td align="right">21</td>
<td align="right">25</td>
<td align="right">0.8400000</td>
</tr>
<tr class="even">
<td align="right">2006</td>
<td align="left">TOR</td>
<td align="right">87</td>
<td align="right">162</td>
<td align="right">18</td>
<td align="right">22</td>
<td align="right">0.8181818</td>
</tr>
<tr class="odd">
<td align="right">1961</td>
<td align="left">LAN</td>
<td align="right">89</td>
<td align="right">154</td>
<td align="right">22</td>
<td align="right">27</td>
<td align="right">0.8148148</td>
</tr>
<tr class="even">
<td align="right">2012</td>
<td align="left">BAL</td>
<td align="right">93</td>
<td align="right">162</td>
<td align="right">29</td>
<td align="right">37</td>
<td align="right">0.7837838</td>
</tr>
<tr class="odd">
<td align="right">1998</td>
<td align="left">NYA</td>
<td align="right">114</td>
<td align="right">162</td>
<td align="right">25</td>
<td align="right">32</td>
<td align="right">0.7812500</td>
</tr>
<tr class="even">
<td align="right">2011</td>
<td align="left">ARI</td>
<td align="right">94</td>
<td align="right">162</td>
<td align="right">16</td>
<td align="right">21</td>
<td align="right">0.7619048</td>
</tr>
<tr class="odd">
<td align="right">1970</td>
<td align="left">MIN</td>
<td align="right">98</td>
<td align="right">162</td>
<td align="right">22</td>
<td align="right">29</td>
<td align="right">0.7586207</td>
</tr>
<tr class="even">
<td align="right">1988</td>
<td align="left">OAK</td>
<td align="right">104</td>
<td align="right">162</td>
<td align="right">22</td>
<td align="right">29</td>
<td align="right">0.7586207</td>
</tr>
<tr class="odd">
<td align="right">2009</td>
<td align="left">NYA</td>
<td align="right">103</td>
<td align="right">162</td>
<td align="right">25</td>
<td align="right">33</td>
<td align="right">0.7575758</td>
</tr>
<tr class="even">
<td align="right">2004</td>
<td align="left">NYA</td>
<td align="right">101</td>
<td align="right">162</td>
<td align="right">18</td>
<td align="right">24</td>
<td align="right">0.7500000</td>
</tr>
<tr class="odd">
<td align="right">2013</td>
<td align="left">CLE</td>
<td align="right">92</td>
<td align="right">162</td>
<td align="right">21</td>
<td align="right">28</td>
<td align="right">0.7500000</td>
</tr>
<tr class="even">
<td align="right">1977</td>
<td align="left">BAL</td>
<td align="right">97</td>
<td align="right">161</td>
<td align="right">26</td>
<td align="right">35</td>
<td align="right">0.7428571</td>
</tr>
<tr class="odd">
<td align="right">2005</td>
<td align="left">PHI</td>
<td align="right">88</td>
<td align="right">162</td>
<td align="right">20</td>
<td align="right">27</td>
<td align="right">0.7407407</td>
</tr>
<tr class="even">
<td align="right">1999</td>
<td align="left">ATL</td>
<td align="right">103</td>
<td align="right">162</td>
<td align="right">28</td>
<td align="right">38</td>
<td align="right">0.7368421</td>
</tr>
<tr class="odd">
<td align="right">1956</td>
<td align="left">BOS</td>
<td align="right">83</td>
<td align="right">152</td>
<td align="right">22</td>
<td align="right">30</td>
<td align="right">0.7333333</td>
</tr>
</tbody>
</table>
<p>And 10th percentile,</p>
<pre class="r"><code>close_definition = 0.1
tables = close_wins_tables(game_win_df, close_definition)
# ordered by wins
knitr::kable(tables$w_table)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">year_id</th>
<th align="left">team_id</th>
<th align="right">w</th>
<th align="right">g</th>
<th align="right">w_close</th>
<th align="right">g_close</th>
<th align="right">wpct_close</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1999</td>
<td align="left">ATL</td>
<td align="right">103</td>
<td align="right">162</td>
<td align="right">20</td>
<td align="right">26</td>
<td align="right">0.7692308</td>
</tr>
<tr class="even">
<td align="right">1974</td>
<td align="left">BAL</td>
<td align="right">91</td>
<td align="right">162</td>
<td align="right">19</td>
<td align="right">25</td>
<td align="right">0.7600000</td>
</tr>
<tr class="odd">
<td align="right">1969</td>
<td align="left">NYN</td>
<td align="right">100</td>
<td align="right">162</td>
<td align="right">18</td>
<td align="right">23</td>
<td align="right">0.7826087</td>
</tr>
<tr class="even">
<td align="right">1996</td>
<td align="left">SDN</td>
<td align="right">91</td>
<td align="right">162</td>
<td align="right">18</td>
<td align="right">26</td>
<td align="right">0.6923077</td>
</tr>
<tr class="odd">
<td align="right">1993</td>
<td align="left">ATL</td>
<td align="right">104</td>
<td align="right">162</td>
<td align="right">17</td>
<td align="right">24</td>
<td align="right">0.7083333</td>
</tr>
<tr class="even">
<td align="right">2002</td>
<td align="left">SFN</td>
<td align="right">95</td>
<td align="right">162</td>
<td align="right">17</td>
<td align="right">25</td>
<td align="right">0.6800000</td>
</tr>
<tr class="odd">
<td align="right">2004</td>
<td align="left">SLN</td>
<td align="right">105</td>
<td align="right">162</td>
<td align="right">17</td>
<td align="right">23</td>
<td align="right">0.7391304</td>
</tr>
<tr class="even">
<td align="right">2009</td>
<td align="left">LAN</td>
<td align="right">95</td>
<td align="right">162</td>
<td align="right">17</td>
<td align="right">28</td>
<td align="right">0.6071429</td>
</tr>
<tr class="odd">
<td align="right">1967</td>
<td align="left">CHA</td>
<td align="right">89</td>
<td align="right">162</td>
<td align="right">16</td>
<td align="right">24</td>
<td align="right">0.6666667</td>
</tr>
<tr class="even">
<td align="right">1970</td>
<td align="left">PHI</td>
<td align="right">73</td>
<td align="right">161</td>
<td align="right">16</td>
<td align="right">23</td>
<td align="right">0.6956522</td>
</tr>
<tr class="odd">
<td align="right">1975</td>
<td align="left">SFN</td>
<td align="right">80</td>
<td align="right">161</td>
<td align="right">16</td>
<td align="right">22</td>
<td align="right">0.7272727</td>
</tr>
<tr class="even">
<td align="right">1980</td>
<td align="left">MON</td>
<td align="right">90</td>
<td align="right">162</td>
<td align="right">16</td>
<td align="right">24</td>
<td align="right">0.6666667</td>
</tr>
<tr class="odd">
<td align="right">1980</td>
<td align="left">SDN</td>
<td align="right">73</td>
<td align="right">163</td>
<td align="right">16</td>
<td align="right">27</td>
<td align="right">0.5925926</td>
</tr>
<tr class="even">
<td align="right">1982</td>
<td align="left">PHI</td>
<td align="right">89</td>
<td align="right">162</td>
<td align="right">16</td>
<td align="right">23</td>
<td align="right">0.6956522</td>
</tr>
<tr class="odd">
<td align="right">1990</td>
<td align="left">BOS</td>
<td align="right">88</td>
<td align="right">162</td>
<td align="right">16</td>
<td align="right">23</td>
<td align="right">0.6956522</td>
</tr>
</tbody>
</table>
<pre class="r"><code># ordered by win percentage
knitr::kable(tables$wpct_table)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">year_id</th>
<th align="left">team_id</th>
<th align="right">w</th>
<th align="right">g</th>
<th align="right">w_close</th>
<th align="right">g_close</th>
<th align="right">wpct_close</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2009</td>
<td align="left">NYA</td>
<td align="right">103</td>
<td align="right">162</td>
<td align="right">12</td>
<td align="right">13</td>
<td align="right">0.9230769</td>
</tr>
<tr class="even">
<td align="right">2003</td>
<td align="left">SFN</td>
<td align="right">100</td>
<td align="right">161</td>
<td align="right">11</td>
<td align="right">12</td>
<td align="right">0.9166667</td>
</tr>
<tr class="odd">
<td align="right">1968</td>
<td align="left">PHI</td>
<td align="right">76</td>
<td align="right">162</td>
<td align="right">9</td>
<td align="right">10</td>
<td align="right">0.9000000</td>
</tr>
<tr class="even">
<td align="right">2012</td>
<td align="left">BAL</td>
<td align="right">93</td>
<td align="right">162</td>
<td align="right">16</td>
<td align="right">18</td>
<td align="right">0.8888889</td>
</tr>
<tr class="odd">
<td align="right">1999</td>
<td align="left">TEX</td>
<td align="right">95</td>
<td align="right">162</td>
<td align="right">13</td>
<td align="right">15</td>
<td align="right">0.8666667</td>
</tr>
<tr class="even">
<td align="right">1984</td>
<td align="left">NYN</td>
<td align="right">90</td>
<td align="right">162</td>
<td align="right">12</td>
<td align="right">14</td>
<td align="right">0.8571429</td>
</tr>
<tr class="odd">
<td align="right">2006</td>
<td align="left">TOR</td>
<td align="right">87</td>
<td align="right">162</td>
<td align="right">6</td>
<td align="right">7</td>
<td align="right">0.8571429</td>
</tr>
<tr class="even">
<td align="right">1998</td>
<td align="left">HOU</td>
<td align="right">102</td>
<td align="right">162</td>
<td align="right">11</td>
<td align="right">13</td>
<td align="right">0.8461538</td>
</tr>
<tr class="odd">
<td align="right">1988</td>
<td align="left">OAK</td>
<td align="right">104</td>
<td align="right">162</td>
<td align="right">15</td>
<td align="right">18</td>
<td align="right">0.8333333</td>
</tr>
<tr class="even">
<td align="right">1995</td>
<td align="left">ATL</td>
<td align="right">90</td>
<td align="right">144</td>
<td align="right">15</td>
<td align="right">18</td>
<td align="right">0.8333333</td>
</tr>
<tr class="odd">
<td align="right">1996</td>
<td align="left">MIL</td>
<td align="right">80</td>
<td align="right">162</td>
<td align="right">10</td>
<td align="right">12</td>
<td align="right">0.8333333</td>
</tr>
<tr class="even">
<td align="right">2000</td>
<td align="left">OAK</td>
<td align="right">91</td>
<td align="right">161</td>
<td align="right">5</td>
<td align="right">6</td>
<td align="right">0.8333333</td>
</tr>
<tr class="odd">
<td align="right">2013</td>
<td align="left">ATL</td>
<td align="right">96</td>
<td align="right">162</td>
<td align="right">10</td>
<td align="right">12</td>
<td align="right">0.8333333</td>
</tr>
<tr class="even">
<td align="right">2017</td>
<td align="left">WAS</td>
<td align="right">97</td>
<td align="right">162</td>
<td align="right">15</td>
<td align="right">18</td>
<td align="right">0.8333333</td>
</tr>
<tr class="odd">
<td align="right">1989</td>
<td align="left">SDN</td>
<td align="right">89</td>
<td align="right">162</td>
<td align="right">14</td>
<td align="right">17</td>
<td align="right">0.8235294</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="non-close-games" class="section level2">
<h2>non-close games</h2>
<p>We can try the same, looking at games that aren’t close. This doesn’t really reflect any strategy but is more just a fun piece of trivia to see which teams had good records in blowouts.</p>
<p>The function definition is almost identical to the one for close games, except we pick games greater than some threshold versus games less than some threshold.</p>
<pre class="r"><code>blowout_wins_tables = function(game_wins_df, close_definition, nteam=15) {

  close_percentile_df = game_wins_df %&gt;% 
    mutate(dummy=1) %&gt;% 
    group_by(year_id) %&gt;% 
    arrange(year_id, closeness_idx) %&gt;% 
    mutate(running = cumsum(dummy), n=n(), c_frac=running / n) %&gt;%
    ungroup() %&gt;% 
    mutate(is_close = c_frac &gt;= close_definition) %&gt;% 
    group_by(year_id, team_id) %&gt;% 
    summarise(w=sum(is_win), g=n(), 
              w_close = sum(is_close * is_win), 
              g_close = sum(is_close), 
              wpct_close = w_close/g_close) %&gt;% 
    rename(w_blowout=w_close, wpct_blowout=wpct_close)
  
  list(w_table = 
         close_percentile_df %&gt;% 
         arrange(-w_blowout) %&gt;% 
         head(nteam),
       wpct_table = 
         close_percentile_df %&gt;% 
         arrange(-wpct_blowout) %&gt;% 
         head(nteam)
       )

}</code></pre>
<pre class="r"><code>blowout_definition = 0.8
tables = blowout_wins_tables(game_win_df, blowout_definition)
# ordered by wins
knitr::kable(tables$w_table)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">year_id</th>
<th align="left">team_id</th>
<th align="right">w</th>
<th align="right">g</th>
<th align="right">w_blowout</th>
<th align="right">g_close</th>
<th align="right">wpct_blowout</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2015</td>
<td align="left">TOR</td>
<td align="right">93</td>
<td align="right">162</td>
<td align="right">33</td>
<td align="right">47</td>
<td align="right">0.7021277</td>
</tr>
<tr class="even">
<td align="right">1983</td>
<td align="left">BAL</td>
<td align="right">98</td>
<td align="right">162</td>
<td align="right">32</td>
<td align="right">51</td>
<td align="right">0.6274510</td>
</tr>
<tr class="odd">
<td align="right">1985</td>
<td align="left">NYA</td>
<td align="right">97</td>
<td align="right">161</td>
<td align="right">32</td>
<td align="right">43</td>
<td align="right">0.7441860</td>
</tr>
<tr class="even">
<td align="right">1956</td>
<td align="left">NYA</td>
<td align="right">97</td>
<td align="right">154</td>
<td align="right">31</td>
<td align="right">47</td>
<td align="right">0.6595745</td>
</tr>
<tr class="odd">
<td align="right">1962</td>
<td align="left">SFN</td>
<td align="right">103</td>
<td align="right">165</td>
<td align="right">31</td>
<td align="right">44</td>
<td align="right">0.7045455</td>
</tr>
<tr class="even">
<td align="right">1970</td>
<td align="left">CHN</td>
<td align="right">84</td>
<td align="right">162</td>
<td align="right">31</td>
<td align="right">41</td>
<td align="right">0.7560976</td>
</tr>
<tr class="odd">
<td align="right">1987</td>
<td align="left">DET</td>
<td align="right">98</td>
<td align="right">162</td>
<td align="right">31</td>
<td align="right">47</td>
<td align="right">0.6595745</td>
</tr>
<tr class="even">
<td align="right">2002</td>
<td align="left">ANA</td>
<td align="right">99</td>
<td align="right">162</td>
<td align="right">31</td>
<td align="right">39</td>
<td align="right">0.7948718</td>
</tr>
<tr class="odd">
<td align="right">1977</td>
<td align="left">NYA</td>
<td align="right">100</td>
<td align="right">162</td>
<td align="right">30</td>
<td align="right">44</td>
<td align="right">0.6818182</td>
</tr>
<tr class="even">
<td align="right">1979</td>
<td align="left">BOS</td>
<td align="right">91</td>
<td align="right">160</td>
<td align="right">30</td>
<td align="right">44</td>
<td align="right">0.6818182</td>
</tr>
<tr class="odd">
<td align="right">1980</td>
<td align="left">KCA</td>
<td align="right">97</td>
<td align="right">162</td>
<td align="right">30</td>
<td align="right">47</td>
<td align="right">0.6382979</td>
</tr>
<tr class="even">
<td align="right">1998</td>
<td align="left">NYA</td>
<td align="right">114</td>
<td align="right">162</td>
<td align="right">30</td>
<td align="right">39</td>
<td align="right">0.7692308</td>
</tr>
<tr class="odd">
<td align="right">1976</td>
<td align="left">CIN</td>
<td align="right">102</td>
<td align="right">162</td>
<td align="right">29</td>
<td align="right">39</td>
<td align="right">0.7435897</td>
</tr>
<tr class="even">
<td align="right">1988</td>
<td align="left">TOR</td>
<td align="right">87</td>
<td align="right">162</td>
<td align="right">29</td>
<td align="right">45</td>
<td align="right">0.6444444</td>
</tr>
<tr class="odd">
<td align="right">1998</td>
<td align="left">HOU</td>
<td align="right">102</td>
<td align="right">162</td>
<td align="right">29</td>
<td align="right">35</td>
<td align="right">0.8285714</td>
</tr>
</tbody>
</table>
<pre class="r"><code># ordered by win percentage
knitr::kable(tables$wpct_table)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">year_id</th>
<th align="left">team_id</th>
<th align="right">w</th>
<th align="right">g</th>
<th align="right">w_blowout</th>
<th align="right">g_close</th>
<th align="right">wpct_blowout</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2017</td>
<td align="left">CLE</td>
<td align="right">102</td>
<td align="right">162</td>
<td align="right">28</td>
<td align="right">32</td>
<td align="right">0.8750000</td>
</tr>
<tr class="even">
<td align="right">1999</td>
<td align="left">ARI</td>
<td align="right">100</td>
<td align="right">162</td>
<td align="right">20</td>
<td align="right">23</td>
<td align="right">0.8695652</td>
</tr>
<tr class="odd">
<td align="right">1969</td>
<td align="left">BAL</td>
<td align="right">109</td>
<td align="right">162</td>
<td align="right">27</td>
<td align="right">32</td>
<td align="right">0.8437500</td>
</tr>
<tr class="even">
<td align="right">1994</td>
<td align="left">ATL</td>
<td align="right">68</td>
<td align="right">114</td>
<td align="right">15</td>
<td align="right">18</td>
<td align="right">0.8333333</td>
</tr>
<tr class="odd">
<td align="right">1998</td>
<td align="left">HOU</td>
<td align="right">102</td>
<td align="right">162</td>
<td align="right">29</td>
<td align="right">35</td>
<td align="right">0.8285714</td>
</tr>
<tr class="even">
<td align="right">2012</td>
<td align="left">TBA</td>
<td align="right">90</td>
<td align="right">162</td>
<td align="right">22</td>
<td align="right">27</td>
<td align="right">0.8148148</td>
</tr>
<tr class="odd">
<td align="right">1971</td>
<td align="left">BAL</td>
<td align="right">101</td>
<td align="right">158</td>
<td align="right">26</td>
<td align="right">32</td>
<td align="right">0.8125000</td>
</tr>
<tr class="even">
<td align="right">1990</td>
<td align="left">PIT</td>
<td align="right">95</td>
<td align="right">162</td>
<td align="right">26</td>
<td align="right">32</td>
<td align="right">0.8125000</td>
</tr>
<tr class="odd">
<td align="right">2012</td>
<td align="left">ATL</td>
<td align="right">94</td>
<td align="right">162</td>
<td align="right">25</td>
<td align="right">31</td>
<td align="right">0.8064516</td>
</tr>
<tr class="even">
<td align="right">2008</td>
<td align="left">CHN</td>
<td align="right">97</td>
<td align="right">161</td>
<td align="right">24</td>
<td align="right">30</td>
<td align="right">0.8000000</td>
</tr>
<tr class="odd">
<td align="right">2016</td>
<td align="left">CHN</td>
<td align="right">103</td>
<td align="right">162</td>
<td align="right">24</td>
<td align="right">30</td>
<td align="right">0.8000000</td>
</tr>
<tr class="even">
<td align="right">2002</td>
<td align="left">ANA</td>
<td align="right">99</td>
<td align="right">162</td>
<td align="right">31</td>
<td align="right">39</td>
<td align="right">0.7948718</td>
</tr>
<tr class="odd">
<td align="right">1976</td>
<td align="left">PHI</td>
<td align="right">101</td>
<td align="right">162</td>
<td align="right">25</td>
<td align="right">32</td>
<td align="right">0.7812500</td>
</tr>
<tr class="even">
<td align="right">1979</td>
<td align="left">BAL</td>
<td align="right">102</td>
<td align="right">159</td>
<td align="right">21</td>
<td align="right">27</td>
<td align="right">0.7777778</td>
</tr>
<tr class="odd">
<td align="right">1997</td>
<td align="left">ATL</td>
<td align="right">101</td>
<td align="right">162</td>
<td align="right">21</td>
<td align="right">27</td>
<td align="right">0.7777778</td>
</tr>
</tbody>
</table>
<p>Ratchet it up to 90th percentile</p>
<pre class="r"><code>blowout_definition = 0.9
tables = blowout_wins_tables(game_win_df, blowout_definition)
# ordered by wins
knitr::kable(tables$w_table)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">year_id</th>
<th align="left">team_id</th>
<th align="right">w</th>
<th align="right">g</th>
<th align="right">w_blowout</th>
<th align="right">g_close</th>
<th align="right">wpct_blowout</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1987</td>
<td align="left">DET</td>
<td align="right">98</td>
<td align="right">162</td>
<td align="right">24</td>
<td align="right">31</td>
<td align="right">0.7741935</td>
</tr>
<tr class="even">
<td align="right">1977</td>
<td align="left">NYA</td>
<td align="right">100</td>
<td align="right">162</td>
<td align="right">21</td>
<td align="right">25</td>
<td align="right">0.8400000</td>
</tr>
<tr class="odd">
<td align="right">2014</td>
<td align="left">OAK</td>
<td align="right">88</td>
<td align="right">162</td>
<td align="right">21</td>
<td align="right">26</td>
<td align="right">0.8076923</td>
</tr>
<tr class="even">
<td align="right">2011</td>
<td align="left">TEX</td>
<td align="right">96</td>
<td align="right">162</td>
<td align="right">19</td>
<td align="right">30</td>
<td align="right">0.6333333</td>
</tr>
<tr class="odd">
<td align="right">2013</td>
<td align="left">SLN</td>
<td align="right">97</td>
<td align="right">162</td>
<td align="right">19</td>
<td align="right">24</td>
<td align="right">0.7916667</td>
</tr>
<tr class="even">
<td align="right">2015</td>
<td align="left">TOR</td>
<td align="right">93</td>
<td align="right">162</td>
<td align="right">19</td>
<td align="right">23</td>
<td align="right">0.8260870</td>
</tr>
<tr class="odd">
<td align="right">1969</td>
<td align="left">MIN</td>
<td align="right">97</td>
<td align="right">162</td>
<td align="right">18</td>
<td align="right">23</td>
<td align="right">0.7826087</td>
</tr>
<tr class="even">
<td align="right">1970</td>
<td align="left">BAL</td>
<td align="right">108</td>
<td align="right">162</td>
<td align="right">18</td>
<td align="right">23</td>
<td align="right">0.7826087</td>
</tr>
<tr class="odd">
<td align="right">1980</td>
<td align="left">KCA</td>
<td align="right">97</td>
<td align="right">162</td>
<td align="right">18</td>
<td align="right">26</td>
<td align="right">0.6923077</td>
</tr>
<tr class="even">
<td align="right">1986</td>
<td align="left">BOS</td>
<td align="right">95</td>
<td align="right">161</td>
<td align="right">18</td>
<td align="right">19</td>
<td align="right">0.9473684</td>
</tr>
<tr class="odd">
<td align="right">1992</td>
<td align="left">MIL</td>
<td align="right">92</td>
<td align="right">162</td>
<td align="right">18</td>
<td align="right">25</td>
<td align="right">0.7200000</td>
</tr>
<tr class="even">
<td align="right">1992</td>
<td align="left">TOR</td>
<td align="right">96</td>
<td align="right">162</td>
<td align="right">18</td>
<td align="right">28</td>
<td align="right">0.6428571</td>
</tr>
<tr class="odd">
<td align="right">1995</td>
<td align="left">CAL</td>
<td align="right">78</td>
<td align="right">145</td>
<td align="right">18</td>
<td align="right">25</td>
<td align="right">0.7200000</td>
</tr>
<tr class="even">
<td align="right">1998</td>
<td align="left">NYA</td>
<td align="right">114</td>
<td align="right">162</td>
<td align="right">18</td>
<td align="right">22</td>
<td align="right">0.8181818</td>
</tr>
<tr class="odd">
<td align="right">2013</td>
<td align="left">DET</td>
<td align="right">93</td>
<td align="right">162</td>
<td align="right">18</td>
<td align="right">21</td>
<td align="right">0.8571429</td>
</tr>
</tbody>
</table>
<pre class="r"><code># ordered by win percentage
knitr::kable(tables$wpct_table)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">year_id</th>
<th align="left">team_id</th>
<th align="right">w</th>
<th align="right">g</th>
<th align="right">w_blowout</th>
<th align="right">g_close</th>
<th align="right">wpct_blowout</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1966</td>
<td align="left">BAL</td>
<td align="right">97</td>
<td align="right">160</td>
<td align="right">11</td>
<td align="right">11</td>
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="right">1977</td>
<td align="left">KCA</td>
<td align="right">102</td>
<td align="right">162</td>
<td align="right">12</td>
<td align="right">12</td>
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="right">1982</td>
<td align="left">CAL</td>
<td align="right">93</td>
<td align="right">162</td>
<td align="right">17</td>
<td align="right">17</td>
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="right">1994</td>
<td align="left">PHI</td>
<td align="right">54</td>
<td align="right">115</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="right">1986</td>
<td align="left">BOS</td>
<td align="right">95</td>
<td align="right">161</td>
<td align="right">18</td>
<td align="right">19</td>
<td align="right">0.9473684</td>
</tr>
<tr class="even">
<td align="right">1998</td>
<td align="left">HOU</td>
<td align="right">102</td>
<td align="right">162</td>
<td align="right">16</td>
<td align="right">17</td>
<td align="right">0.9411765</td>
</tr>
<tr class="odd">
<td align="right">2017</td>
<td align="left">CLE</td>
<td align="right">102</td>
<td align="right">162</td>
<td align="right">16</td>
<td align="right">17</td>
<td align="right">0.9411765</td>
</tr>
<tr class="even">
<td align="right">1969</td>
<td align="left">BAL</td>
<td align="right">109</td>
<td align="right">162</td>
<td align="right">15</td>
<td align="right">16</td>
<td align="right">0.9375000</td>
</tr>
<tr class="odd">
<td align="right">1995</td>
<td align="left">CLE</td>
<td align="right">100</td>
<td align="right">144</td>
<td align="right">14</td>
<td align="right">15</td>
<td align="right">0.9333333</td>
</tr>
<tr class="even">
<td align="right">1991</td>
<td align="left">PIT</td>
<td align="right">98</td>
<td align="right">162</td>
<td align="right">12</td>
<td align="right">13</td>
<td align="right">0.9230769</td>
</tr>
<tr class="odd">
<td align="right">1960</td>
<td align="left">DET</td>
<td align="right">71</td>
<td align="right">154</td>
<td align="right">11</td>
<td align="right">12</td>
<td align="right">0.9166667</td>
</tr>
<tr class="even">
<td align="right">1986</td>
<td align="left">NYN</td>
<td align="right">108</td>
<td align="right">162</td>
<td align="right">11</td>
<td align="right">12</td>
<td align="right">0.9166667</td>
</tr>
<tr class="odd">
<td align="right">2009</td>
<td align="left">PHI</td>
<td align="right">93</td>
<td align="right">162</td>
<td align="right">11</td>
<td align="right">12</td>
<td align="right">0.9166667</td>
</tr>
<tr class="even">
<td align="right">2002</td>
<td align="left">BOS</td>
<td align="right">93</td>
<td align="right">162</td>
<td align="right">17</td>
<td align="right">19</td>
<td align="right">0.8947368</td>
</tr>
<tr class="odd">
<td align="right">1984</td>
<td align="left">MON</td>
<td align="right">78</td>
<td align="right">161</td>
<td align="right">7</td>
<td align="right">8</td>
<td align="right">0.8750000</td>
</tr>
</tbody>
</table>
</div>
<div id="records-in-close-vs-non-close-games" class="section level2">
<h2>Records in close vs non-close games</h2>
<p>The main point output of the look at <a href="../../../../2018/06/15/record-in-one-run-games/">one-run games</a> was a graph of win percentage in one-run vs non-one-run games. This graph reproduces that, using top 20th percentile of closeness as the replacement for one-run games.</p>
<pre class="r"><code>close_definition = 0.2

plot_df = close_percentile_df = game_win_df %&gt;% 
  mutate(dummy=1) %&gt;% 
  group_by(year_id) %&gt;% 
  arrange(year_id, closeness_idx) %&gt;% 
  mutate(running = cumsum(dummy), n=n(), c_frac=running / n) %&gt;%
  ungroup() %&gt;% 
  mutate(is_close = c_frac &lt;= close_definition) %&gt;% 
  group_by(year_id, team_id) %&gt;% 
  summarise(w=sum(is_win), g=n(), 
            w_close = sum(is_close * is_win), 
            g_close = sum(is_close), 
            wpct_close = w_close/g_close, 
            wpct_other = (w-w_close)/(g - g_close)) %&gt;% 
  ungroup()</code></pre>
<pre class="r"><code># the base plot
p = plot_df %&gt;% 
  ggplot(aes(x=wpct_other, y=wpct_close)) + 
  geom_point() + 
  theme_minimal(base_size = 16) + 
  geom_hline(yintercept = 0.5, size=0.5, color=&#39;steelblue&#39;) + 
  geom_vline(xintercept = 0.5, size=0.5, color=&#39;steelblue&#39;) + 
  labs(x=&quot;Win Pct. - Non close games&quot;, y=&quot;Win Pct. - close games&quot;)</code></pre>
<p>Label the ones that are on the edges</p>
<pre class="r"><code>records_quads = plot_df %&gt;% 
  mutate(r2=(wpct_other - 0.5)**2 + (wpct_close - 0.5)**2, 
         quad=as.integer(wpct_other &gt;= 0.5) + 2 * as.integer(wpct_close &gt;= 0.5))

lab_df = records_quads %&gt;% 
  group_by(quad) %&gt;% 
  arrange(-r2) %&gt;% 
  mutate(r2_rank=row_number()) %&gt;% 
  filter(r2_rank &lt;= 10) %&gt;% 
  ungroup() %&gt;% 
  mutate(name=paste(team_id, year_id))</code></pre>
<pre class="r"><code># base plot with outliers labelled
p2 = p + 
  geom_text_repel(data = lab_df, aes(x=wpct_other, y=wpct_close, label=name))
print(p2)</code></pre>
<p><img src="/post/2018-06-17-closeness-index-one-run-games_files/figure-html/unnamed-chunk-24-1.png" width="768" /></p>
</div>

</main>

    <footer>
      
<script>
(function() {
  function center_el(tagName) {
    var tags = document.getElementsByTagName(tagName), i, tag;
    for (i = 0; i < tags.length; i++) {
      tag = tags[i];
      var parent = tag.parentElement;
      
      if (parent.childNodes.length === 1) {
        
        if (parent.nodeName === 'A') {
          parent = parent.parentElement;
          if (parent.childNodes.length != 1) continue;
        }
        if (parent.nodeName === 'P') parent.style.textAlign = 'center';
      }
    }
  }
  var tagNames = ['img', 'embed', 'object'];
  for (var i = 0; i < tagNames.length; i++) {
    center_el(tagNames[i]);
  }
})();
</script>

<script src="//yihui.name/js/math-code.js"></script>
<script async
src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-71774734-3', 'auto');
    ga('send', 'pageview');

</script>



      
    </footer>
  </body>
</html>

