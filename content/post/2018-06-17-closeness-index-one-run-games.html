

<p>The <a href="../blah">last post</a> looked at records in one-run games. This topic is in the zeitgeist currently since because of the Mariners high number of wins. It turns out that Baseball Musings offered a alternative way of thinking about it some 8 years ago. The overarching idea here is that one-run games are kind of a proxy for tight games - but there’s a difference between a game that’s not close, and then the bullpen blows a lead and it ends up at 1-run, versus a game that’s close the whole way. The second type is qualitatively different and if we’re going to look for team makeups that lead to success in one-run games, tells us more about how strategy might factor in.</p>
<p>To reemphasise what the technical idea is, you compute a closeness index for a game by taking the average of the absolute value of the score differential at the end of each half inning. So there’s a lower limit for a regulation 9-inning game of 1/18 = 0.056.</p>
<p>This post will use this definition for closeness index and expnad on the wrok for Baseball Musings.</p>
<div id="libraries" class="section level2">
<h2>libraries</h2>
<pre class="r"><code>library(RPostgres)
library(DBI)
library(dplyr)
library(ggplot2)
library(ggrepel)
library(tidyr)</code></pre>
</div>
<div id="data" class="section level2">
<h2>data</h2>
<p>I’ll use the retrosheet event-level data. This is overkill in a way since I only need scores at the end of half-innings, but it’s the best way I know how to get that.</p>
<p>In Baseball Musings look at closeness, he looked exclusively at 1974+, where the records are 100% complete. I’m going to look at 1955+ since I’m looking mainly for outliers and overall trends and am not overly concernbed with completeness ; a maxim I generally live by is don;t let the perfect be the enem,y of the good.</p>
<p>connect to the database</p>
<pre class="r"><code>conn &lt;- dbConnect(RPostgres::Postgres(), 
                  password=Sys.getenv(&quot;PSQL_PASS&quot;), 
                  user=Sys.getenv(&quot;PSQL_USER&quot;), 
                  port=Sys.getenv(&quot;PSQL_PORT&quot;), 
                  dbname=&#39;retrosheet&#39;)</code></pre>
<p>Grab data since 1955, filtering to only include end of innings</p>
<pre class="r"><code>  ev = dbGetQuery(conn, &quot;select * from event where year_id &gt; 1954 and inn_end_fl = \&#39;t\&#39;&quot;)</code></pre>
<p>Process the data to</p>
<ul>
<li>runs</li>
</ul>
<pre class="r"><code>process_data = function(ev) {
  ev2 = ev %&gt;% 
    mutate(home_score = home_score_ct + ifelse(bat_home_id==1, event_runs_ct, 0), 
           away_score = away_score_ct + ifelse(bat_home_id==0, event_runs_ct, 0))
  evA = ev2 %&gt;% 
    select(game_id, inn_ct, year_id, bat_home_id, 
           team_id=home_team_id, opp_id=away_team_id, 
           team_score=home_score, opp_score=away_score)
  evH = ev2 %&gt;% 
    select(game_id, inn_ct, year_id, bat_home_id,
           team_id=away_team_id, opp_id=home_team_id, 
           team_score=away_score, opp_score=home_score)
  
  evX = dplyr::bind_rows(evA, evH) %&gt;% 
    mutate(close_idx = abs(team_score - opp_score))

}</code></pre>
<pre class="r"><code>evX = process_data(ev)</code></pre>
<p>add the wins</p>
<pre class="r"><code>get_wins = function(evX) {
  win_df = evX %&gt;% 
    group_by(game_id) %&gt;% 
    mutate(mx = max(inn_ct)) %&gt;% 
    filter(inn_ct==mx) %&gt;% 
    arrange(-bat_home_id) %&gt;% 
    mutate(ridx= row_number()) %&gt;% 
    filter(ridx &lt;= 2) %&gt;% mutate(is_win= team_score &gt; opp_score) %&gt;% 
    select(game_id, team_id, is_win)
  
  win_df %&gt;% inner_join(evX, by=c(&quot;game_id&quot;, &quot;team_id&quot;)) %&gt;% 
    group_by(game_id, year_id, team_id) %&gt;% 
    mutate(closeness_score=mean(close_idx)) %&gt;% ungroup()
  
}</code></pre>
<pre class="r"><code>w = get_wins(evX)</code></pre>
<p>Compute the closeness index for each game</p>
<pre class="r"><code>w2 = w %&gt;% 
  group_by(game_id, team_id, is_win, year_id) %&gt;% 
  summarise(closeness_idx=mean(close_idx)) %&gt;% 
  ungroup()</code></pre>
<p>The distribution of closeness index</p>
<pre class="r"><code>p = w2 %&gt;% ggplot(aes(x=closeness_idx)) + 
  geom_histogram(binwidth = 0.5) + 
  theme_minimal(base_size = 16)
print(p)</code></pre>
<p><img src="2018-06-17-closeness-index-one-run-games_files/figure-html/unnamed-chunk-9-1.png" width="768" /></p>
<p>The top lowest games</p>
<pre class="r"><code>w2 %&gt;% group_by(game_id) %&gt;% 
  summarise(closeness_idx=mean(closeness_idx)) %&gt;%
  arrange(closeness_idx) %&gt;% 
  filter(closeness_idx &lt; 0.032) %&gt;% 
  knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">game_id</th>
<th align="right">closeness_idx</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">BAL195705192</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">CHN195608122</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">NYN196510022</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">SLN198909130</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">HOU196804150</td>
<td align="right">0.0208333</td>
</tr>
<tr class="even">
<td align="left">OAK197107090</td>
<td align="right">0.0250000</td>
</tr>
<tr class="odd">
<td align="left">BAL197409270</td>
<td align="right">0.0294118</td>
</tr>
<tr class="even">
<td align="left">CHA196709130</td>
<td align="right">0.0294118</td>
</tr>
<tr class="odd">
<td align="left">HOU198008230</td>
<td align="right">0.0294118</td>
</tr>
<tr class="even">
<td align="left">MON198109210</td>
<td align="right">0.0294118</td>
</tr>
<tr class="odd">
<td align="left">NYN199309290</td>
<td align="right">0.0294118</td>
</tr>
<tr class="even">
<td align="left">BAL195909112</td>
<td align="right">0.0312500</td>
</tr>
<tr class="odd">
<td align="left">CHN200305310</td>
<td align="right">0.0312500</td>
</tr>
<tr class="even">
<td align="left">HOU197604210</td>
<td align="right">0.0312500</td>
</tr>
<tr class="odd">
<td align="left">PHI199105170</td>
<td align="right">0.0312500</td>
</tr>
<tr class="even">
<td align="left">SFN196307020</td>
<td align="right">0.0312500</td>
</tr>
</tbody>
</table>
<p>Highest</p>
<pre class="r"><code>w2 %&gt;% group_by(game_id) %&gt;% 
  summarise(closeness_idx=mean(closeness_idx)) %&gt;%
  arrange(-closeness_idx) %&gt;% 
  filter(closeness_idx &gt; 12.6) %&gt;% 
  knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">game_id</th>
<th align="right">closeness_idx</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">CHN197509160</td>
<td align="right">16.11111</td>
</tr>
<tr class="even">
<td align="left">TOR197908250</td>
<td align="right">15.66667</td>
</tr>
<tr class="odd">
<td align="left">DET200409091</td>
<td align="right">15.61111</td>
</tr>
<tr class="even">
<td align="left">BOS200306270</td>
<td align="right">14.58824</td>
</tr>
<tr class="odd">
<td align="left">NYA200904180</td>
<td align="right">14.00000</td>
</tr>
<tr class="even">
<td align="left">KC1195504230</td>
<td align="right">13.66667</td>
</tr>
<tr class="odd">
<td align="left">SLN196108030</td>
<td align="right">13.55556</td>
</tr>
<tr class="even">
<td align="left">BAL200009280</td>
<td align="right">13.47059</td>
</tr>
<tr class="odd">
<td align="left">NYA201107302</td>
<td align="right">13.47059</td>
</tr>
<tr class="even">
<td align="left">PHI198506110</td>
<td align="right">13.23529</td>
</tr>
<tr class="odd">
<td align="left">MIN198207150</td>
<td align="right">13.22222</td>
</tr>
<tr class="even">
<td align="left">BOS199906260</td>
<td align="right">13.11765</td>
</tr>
<tr class="odd">
<td align="left">PHI200907060</td>
<td align="right">13.11765</td>
</tr>
<tr class="even">
<td align="left">KCA200609230</td>
<td align="right">13.00000</td>
</tr>
<tr class="odd">
<td align="left">KCA200006180</td>
<td align="right">12.94444</td>
</tr>
<tr class="even">
<td align="left">COL200509200</td>
<td align="right">12.88235</td>
</tr>
<tr class="odd">
<td align="left">SDN196906280</td>
<td align="right">12.77778</td>
</tr>
<tr class="even">
<td align="left">NYA200006180</td>
<td align="right">12.66667</td>
</tr>
<tr class="odd">
<td align="left">ATL199906130</td>
<td align="right">12.61111</td>
</tr>
</tbody>
</table>
</div>
<div id="seasonal-trends" class="section level2">
<h2>seasonal trends</h2>
<p>Based on the table above we can see that closeness - as measured by score differential - is related to the run scoring environment. Here’s the yearly averages,</p>
<pre class="r"><code>p = w2 %&gt;% group_by(year_id) %&gt;% 
  summarise(closeness_idx = mean(closeness_idx)) %&gt;% 
  ggplot(aes(x=year_id, y=closeness_idx)) + 
  geom_point(size=0.5) + 
  geom_line() + theme_minimal(base_size = 16)
print(p)</code></pre>
<p><img src="2018-06-17-closeness-index-one-run-games_files/figure-html/unnamed-chunk-12-1.png" width="768" /></p>
</div>
<div id="team-records" class="section level2">
<h2>team records</h2>
<p>Fraction of all games that are one-run games</p>
<pre class="r"><code>p = w %&gt;% group_by(game_id, year_id, team_id) %&gt;% summarise(team_score=max(team_score), opp_score = max(opp_score)) %&gt;% ungroup() %&gt;% mutate(is1 = abs(team_score - opp_score) == 1) %&gt;% group_by(year_id) %&gt;% summarise(frac1 = mean(is1)) %&gt;% ggplot(aes(x=year_id, y=frac1)) + geom_line()
print(p)</code></pre>
<p><img src="2018-06-17-closeness-index-one-run-games_files/figure-html/unnamed-chunk-13-1.png" width="768" /></p>
<p>Based on the above we see that historically “one-run games” occur something like 30% of the time. Here I take the lowest 30% of closeness index as definition of “close games” and see which teams had the most wins and highest win percentage</p>
<pre class="r"><code>close_definition = 0.3

close_percentile_df = w2 %&gt;% 
  mutate(dummy=1) %&gt;% 
  group_by(year_id) %&gt;% 
  arrange(year_id, closeness_idx) %&gt;% 
  mutate(running = cumsum(dummy), n=n(), c_frac=running / n) %&gt;%
  ungroup()</code></pre>
<pre class="r"><code>close_percentile_df %&gt;% 
  mutate(is_close = c_frac &lt;= close_definition) %&gt;% 
  group_by(year_id, team_id) %&gt;% 
  summarise(w=sum(is_win), g=n(), 
            w_close = sum(is_close * is_win), 
            g_close = sum(is_close), 
            wpct_close = w_close/g_close) %&gt;% 
  arrange(-w_close) %&gt;% head(20) %&gt;% knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">year_id</th>
<th align="left">team_id</th>
<th align="right">w</th>
<th align="right">g</th>
<th align="right">w_close</th>
<th align="right">g_close</th>
<th align="right">wpct_close</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1969</td>
<td align="left">NYN</td>
<td align="right">100</td>
<td align="right">162</td>
<td align="right">42</td>
<td align="right">60</td>
<td align="right">0.7000000</td>
</tr>
<tr class="even">
<td align="right">1959</td>
<td align="left">CHA</td>
<td align="right">94</td>
<td align="right">156</td>
<td align="right">40</td>
<td align="right">56</td>
<td align="right">0.7142857</td>
</tr>
<tr class="odd">
<td align="right">1992</td>
<td align="left">PIT</td>
<td align="right">96</td>
<td align="right">162</td>
<td align="right">40</td>
<td align="right">60</td>
<td align="right">0.6666667</td>
</tr>
<tr class="even">
<td align="right">2002</td>
<td align="left">LAN</td>
<td align="right">92</td>
<td align="right">162</td>
<td align="right">40</td>
<td align="right">61</td>
<td align="right">0.6557377</td>
</tr>
<tr class="odd">
<td align="right">2011</td>
<td align="left">SFN</td>
<td align="right">86</td>
<td align="right">162</td>
<td align="right">40</td>
<td align="right">70</td>
<td align="right">0.5714286</td>
</tr>
<tr class="even">
<td align="right">1999</td>
<td align="left">ATL</td>
<td align="right">103</td>
<td align="right">162</td>
<td align="right">39</td>
<td align="right">56</td>
<td align="right">0.6964286</td>
</tr>
<tr class="odd">
<td align="right">2003</td>
<td align="left">LAN</td>
<td align="right">85</td>
<td align="right">162</td>
<td align="right">39</td>
<td align="right">71</td>
<td align="right">0.5492958</td>
</tr>
<tr class="even">
<td align="right">1993</td>
<td align="left">ATL</td>
<td align="right">104</td>
<td align="right">162</td>
<td align="right">38</td>
<td align="right">60</td>
<td align="right">0.6333333</td>
</tr>
<tr class="odd">
<td align="right">2015</td>
<td align="left">SLN</td>
<td align="right">100</td>
<td align="right">162</td>
<td align="right">38</td>
<td align="right">66</td>
<td align="right">0.5757576</td>
</tr>
<tr class="even">
<td align="right">2016</td>
<td align="left">SFN</td>
<td align="right">87</td>
<td align="right">162</td>
<td align="right">38</td>
<td align="right">63</td>
<td align="right">0.6031746</td>
</tr>
<tr class="odd">
<td align="right">1965</td>
<td align="left">LAN</td>
<td align="right">97</td>
<td align="right">162</td>
<td align="right">37</td>
<td align="right">68</td>
<td align="right">0.5441176</td>
</tr>
<tr class="even">
<td align="right">1966</td>
<td align="left">LAN</td>
<td align="right">95</td>
<td align="right">162</td>
<td align="right">37</td>
<td align="right">59</td>
<td align="right">0.6271186</td>
</tr>
<tr class="odd">
<td align="right">1977</td>
<td align="left">BAL</td>
<td align="right">97</td>
<td align="right">161</td>
<td align="right">37</td>
<td align="right">52</td>
<td align="right">0.7115385</td>
</tr>
<tr class="even">
<td align="right">1995</td>
<td align="left">ATL</td>
<td align="right">90</td>
<td align="right">144</td>
<td align="right">37</td>
<td align="right">59</td>
<td align="right">0.6271186</td>
</tr>
<tr class="odd">
<td align="right">2008</td>
<td align="left">ANA</td>
<td align="right">100</td>
<td align="right">162</td>
<td align="right">37</td>
<td align="right">58</td>
<td align="right">0.6379310</td>
</tr>
<tr class="even">
<td align="right">2009</td>
<td align="left">NYA</td>
<td align="right">103</td>
<td align="right">162</td>
<td align="right">37</td>
<td align="right">48</td>
<td align="right">0.7708333</td>
</tr>
<tr class="odd">
<td align="right">2012</td>
<td align="left">BAL</td>
<td align="right">93</td>
<td align="right">162</td>
<td align="right">37</td>
<td align="right">53</td>
<td align="right">0.6981132</td>
</tr>
<tr class="even">
<td align="right">2012</td>
<td align="left">CIN</td>
<td align="right">97</td>
<td align="right">162</td>
<td align="right">37</td>
<td align="right">63</td>
<td align="right">0.5873016</td>
</tr>
<tr class="odd">
<td align="right">1976</td>
<td align="left">CHN</td>
<td align="right">75</td>
<td align="right">162</td>
<td align="right">36</td>
<td align="right">63</td>
<td align="right">0.5714286</td>
</tr>
<tr class="even">
<td align="right">1979</td>
<td align="left">HOU</td>
<td align="right">89</td>
<td align="right">162</td>
<td align="right">36</td>
<td align="right">59</td>
<td align="right">0.6101695</td>
</tr>
</tbody>
</table>
<pre class="r"><code>close_percentile_df %&gt;% 
  mutate(is_close = c_frac &lt;= close_definition) %&gt;% 
  group_by(year_id, team_id) %&gt;% 
  summarise(w=sum(is_win), g=n(), 
            w_close = sum(is_close * is_win), 
            g_close = sum(is_close), 
            wpct_close = w_close/g_close) %&gt;% 
  arrange(-wpct_close) %&gt;% head(20) %&gt;% knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">year_id</th>
<th align="left">team_id</th>
<th align="right">w</th>
<th align="right">g</th>
<th align="right">w_close</th>
<th align="right">g_close</th>
<th align="right">wpct_close</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2009</td>
<td align="left">NYA</td>
<td align="right">103</td>
<td align="right">162</td>
<td align="right">37</td>
<td align="right">48</td>
<td align="right">0.7708333</td>
</tr>
<tr class="even">
<td align="right">1961</td>
<td align="left">LAN</td>
<td align="right">89</td>
<td align="right">154</td>
<td align="right">32</td>
<td align="right">43</td>
<td align="right">0.7441860</td>
</tr>
<tr class="odd">
<td align="right">1995</td>
<td align="left">CLE</td>
<td align="right">100</td>
<td align="right">144</td>
<td align="right">34</td>
<td align="right">46</td>
<td align="right">0.7391304</td>
</tr>
<tr class="even">
<td align="right">2007</td>
<td align="left">NYN</td>
<td align="right">88</td>
<td align="right">162</td>
<td align="right">29</td>
<td align="right">40</td>
<td align="right">0.7250000</td>
</tr>
<tr class="odd">
<td align="right">1956</td>
<td align="left">BOS</td>
<td align="right">83</td>
<td align="right">152</td>
<td align="right">30</td>
<td align="right">42</td>
<td align="right">0.7142857</td>
</tr>
<tr class="even">
<td align="right">1959</td>
<td align="left">CHA</td>
<td align="right">94</td>
<td align="right">156</td>
<td align="right">40</td>
<td align="right">56</td>
<td align="right">0.7142857</td>
</tr>
<tr class="odd">
<td align="right">1977</td>
<td align="left">BAL</td>
<td align="right">97</td>
<td align="right">161</td>
<td align="right">37</td>
<td align="right">52</td>
<td align="right">0.7115385</td>
</tr>
<tr class="even">
<td align="right">1999</td>
<td align="left">TEX</td>
<td align="right">95</td>
<td align="right">162</td>
<td align="right">27</td>
<td align="right">38</td>
<td align="right">0.7105263</td>
</tr>
<tr class="odd">
<td align="right">1961</td>
<td align="left">CIN</td>
<td align="right">93</td>
<td align="right">154</td>
<td align="right">29</td>
<td align="right">41</td>
<td align="right">0.7073171</td>
</tr>
<tr class="even">
<td align="right">1995</td>
<td align="left">BOS</td>
<td align="right">86</td>
<td align="right">144</td>
<td align="right">29</td>
<td align="right">41</td>
<td align="right">0.7073171</td>
</tr>
<tr class="odd">
<td align="right">1998</td>
<td align="left">NYA</td>
<td align="right">114</td>
<td align="right">162</td>
<td align="right">29</td>
<td align="right">41</td>
<td align="right">0.7073171</td>
</tr>
<tr class="even">
<td align="right">2012</td>
<td align="left">OAK</td>
<td align="right">94</td>
<td align="right">162</td>
<td align="right">36</td>
<td align="right">51</td>
<td align="right">0.7058824</td>
</tr>
<tr class="odd">
<td align="right">1963</td>
<td align="left">LAN</td>
<td align="right">99</td>
<td align="right">163</td>
<td align="right">35</td>
<td align="right">50</td>
<td align="right">0.7000000</td>
</tr>
<tr class="even">
<td align="right">1969</td>
<td align="left">NYN</td>
<td align="right">100</td>
<td align="right">162</td>
<td align="right">42</td>
<td align="right">60</td>
<td align="right">0.7000000</td>
</tr>
<tr class="odd">
<td align="right">2012</td>
<td align="left">BAL</td>
<td align="right">93</td>
<td align="right">162</td>
<td align="right">37</td>
<td align="right">53</td>
<td align="right">0.6981132</td>
</tr>
<tr class="even">
<td align="right">2002</td>
<td align="left">OAK</td>
<td align="right">103</td>
<td align="right">162</td>
<td align="right">30</td>
<td align="right">43</td>
<td align="right">0.6976744</td>
</tr>
<tr class="odd">
<td align="right">2004</td>
<td align="left">NYA</td>
<td align="right">101</td>
<td align="right">162</td>
<td align="right">30</td>
<td align="right">43</td>
<td align="right">0.6976744</td>
</tr>
<tr class="even">
<td align="right">1999</td>
<td align="left">ATL</td>
<td align="right">103</td>
<td align="right">162</td>
<td align="right">39</td>
<td align="right">56</td>
<td align="right">0.6964286</td>
</tr>
<tr class="odd">
<td align="right">1970</td>
<td align="left">CIN</td>
<td align="right">102</td>
<td align="right">162</td>
<td align="right">32</td>
<td align="right">46</td>
<td align="right">0.6956522</td>
</tr>
<tr class="even">
<td align="right">1984</td>
<td align="left">NYN</td>
<td align="right">90</td>
<td align="right">162</td>
<td align="right">32</td>
<td align="right">46</td>
<td align="right">0.6956522</td>
</tr>
</tbody>
</table>
<p>Let’s tighten that up to 20th percentile</p>
<pre class="r"><code>close_definition = 0.2</code></pre>
<pre class="r"><code>close_percentile_df %&gt;% 
  mutate(is_close = c_frac &lt;= close_definition) %&gt;% 
  group_by(year_id, team_id) %&gt;% 
  summarise(w=sum(is_win), g=n(), 
            w_close = sum(is_close * is_win), 
            g_close = sum(is_close), 
            wpct_close = w_close/g_close) %&gt;% 
  arrange(-w_close) %&gt;% head(20) %&gt;% knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">year_id</th>
<th align="left">team_id</th>
<th align="right">w</th>
<th align="right">g</th>
<th align="right">w_close</th>
<th align="right">g_close</th>
<th align="right">wpct_close</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2011</td>
<td align="left">SFN</td>
<td align="right">86</td>
<td align="right">162</td>
<td align="right">32</td>
<td align="right">52</td>
<td align="right">0.6153846</td>
</tr>
<tr class="even">
<td align="right">1969</td>
<td align="left">NYN</td>
<td align="right">100</td>
<td align="right">162</td>
<td align="right">31</td>
<td align="right">43</td>
<td align="right">0.7209302</td>
</tr>
<tr class="odd">
<td align="right">1968</td>
<td align="left">SLN</td>
<td align="right">97</td>
<td align="right">162</td>
<td align="right">29</td>
<td align="right">40</td>
<td align="right">0.7250000</td>
</tr>
<tr class="even">
<td align="right">2003</td>
<td align="left">LAN</td>
<td align="right">85</td>
<td align="right">162</td>
<td align="right">29</td>
<td align="right">52</td>
<td align="right">0.5576923</td>
</tr>
<tr class="odd">
<td align="right">2012</td>
<td align="left">BAL</td>
<td align="right">93</td>
<td align="right">162</td>
<td align="right">29</td>
<td align="right">37</td>
<td align="right">0.7837838</td>
</tr>
<tr class="even">
<td align="right">2016</td>
<td align="left">SFN</td>
<td align="right">87</td>
<td align="right">162</td>
<td align="right">29</td>
<td align="right">48</td>
<td align="right">0.6041667</td>
</tr>
<tr class="odd">
<td align="right">1959</td>
<td align="left">CHA</td>
<td align="right">94</td>
<td align="right">156</td>
<td align="right">28</td>
<td align="right">39</td>
<td align="right">0.7179487</td>
</tr>
<tr class="even">
<td align="right">1985</td>
<td align="left">NYN</td>
<td align="right">98</td>
<td align="right">162</td>
<td align="right">28</td>
<td align="right">48</td>
<td align="right">0.5833333</td>
</tr>
<tr class="odd">
<td align="right">1993</td>
<td align="left">SLN</td>
<td align="right">87</td>
<td align="right">162</td>
<td align="right">28</td>
<td align="right">49</td>
<td align="right">0.5714286</td>
</tr>
<tr class="even">
<td align="right">1999</td>
<td align="left">ATL</td>
<td align="right">103</td>
<td align="right">162</td>
<td align="right">28</td>
<td align="right">38</td>
<td align="right">0.7368421</td>
</tr>
<tr class="odd">
<td align="right">2011</td>
<td align="left">WAS</td>
<td align="right">80</td>
<td align="right">161</td>
<td align="right">28</td>
<td align="right">44</td>
<td align="right">0.6363636</td>
</tr>
<tr class="even">
<td align="right">1963</td>
<td align="left">HOU</td>
<td align="right">66</td>
<td align="right">162</td>
<td align="right">27</td>
<td align="right">45</td>
<td align="right">0.6000000</td>
</tr>
<tr class="odd">
<td align="right">1975</td>
<td align="left">SFN</td>
<td align="right">80</td>
<td align="right">161</td>
<td align="right">27</td>
<td align="right">40</td>
<td align="right">0.6750000</td>
</tr>
<tr class="even">
<td align="right">1993</td>
<td align="left">MON</td>
<td align="right">94</td>
<td align="right">163</td>
<td align="right">27</td>
<td align="right">46</td>
<td align="right">0.5869565</td>
</tr>
<tr class="odd">
<td align="right">2004</td>
<td align="left">MIN</td>
<td align="right">92</td>
<td align="right">162</td>
<td align="right">27</td>
<td align="right">42</td>
<td align="right">0.6428571</td>
</tr>
<tr class="even">
<td align="right">2004</td>
<td align="left">OAK</td>
<td align="right">91</td>
<td align="right">162</td>
<td align="right">27</td>
<td align="right">42</td>
<td align="right">0.6428571</td>
</tr>
<tr class="odd">
<td align="right">2007</td>
<td align="left">TOR</td>
<td align="right">83</td>
<td align="right">162</td>
<td align="right">27</td>
<td align="right">48</td>
<td align="right">0.5625000</td>
</tr>
<tr class="even">
<td align="right">2008</td>
<td align="left">ANA</td>
<td align="right">100</td>
<td align="right">162</td>
<td align="right">27</td>
<td align="right">43</td>
<td align="right">0.6279070</td>
</tr>
<tr class="odd">
<td align="right">1969</td>
<td align="left">BAL</td>
<td align="right">109</td>
<td align="right">162</td>
<td align="right">26</td>
<td align="right">40</td>
<td align="right">0.6500000</td>
</tr>
<tr class="even">
<td align="right">1970</td>
<td align="left">BAL</td>
<td align="right">108</td>
<td align="right">162</td>
<td align="right">26</td>
<td align="right">38</td>
<td align="right">0.6842105</td>
</tr>
</tbody>
</table>
<pre class="r"><code>close_percentile_df %&gt;% 
  mutate(is_close = c_frac &lt;= close_definition) %&gt;% 
  group_by(year_id, team_id) %&gt;% 
  summarise(w=sum(is_win), g=n(), 
            w_close = sum(is_close * is_win), 
            g_close = sum(is_close), 
            wpct_close = w_close/g_close) %&gt;% 
  arrange(-wpct_close) %&gt;% head(20) %&gt;% knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">year_id</th>
<th align="left">team_id</th>
<th align="right">w</th>
<th align="right">g</th>
<th align="right">w_close</th>
<th align="right">g_close</th>
<th align="right">wpct_close</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1999</td>
<td align="left">TEX</td>
<td align="right">95</td>
<td align="right">162</td>
<td align="right">21</td>
<td align="right">25</td>
<td align="right">0.8400000</td>
</tr>
<tr class="even">
<td align="right">2006</td>
<td align="left">TOR</td>
<td align="right">87</td>
<td align="right">162</td>
<td align="right">18</td>
<td align="right">22</td>
<td align="right">0.8181818</td>
</tr>
<tr class="odd">
<td align="right">1961</td>
<td align="left">LAN</td>
<td align="right">89</td>
<td align="right">154</td>
<td align="right">22</td>
<td align="right">27</td>
<td align="right">0.8148148</td>
</tr>
<tr class="even">
<td align="right">2012</td>
<td align="left">BAL</td>
<td align="right">93</td>
<td align="right">162</td>
<td align="right">29</td>
<td align="right">37</td>
<td align="right">0.7837838</td>
</tr>
<tr class="odd">
<td align="right">1998</td>
<td align="left">NYA</td>
<td align="right">114</td>
<td align="right">162</td>
<td align="right">25</td>
<td align="right">32</td>
<td align="right">0.7812500</td>
</tr>
<tr class="even">
<td align="right">2011</td>
<td align="left">ARI</td>
<td align="right">94</td>
<td align="right">162</td>
<td align="right">16</td>
<td align="right">21</td>
<td align="right">0.7619048</td>
</tr>
<tr class="odd">
<td align="right">1970</td>
<td align="left">MIN</td>
<td align="right">98</td>
<td align="right">162</td>
<td align="right">22</td>
<td align="right">29</td>
<td align="right">0.7586207</td>
</tr>
<tr class="even">
<td align="right">1988</td>
<td align="left">OAK</td>
<td align="right">104</td>
<td align="right">162</td>
<td align="right">22</td>
<td align="right">29</td>
<td align="right">0.7586207</td>
</tr>
<tr class="odd">
<td align="right">2009</td>
<td align="left">NYA</td>
<td align="right">103</td>
<td align="right">162</td>
<td align="right">25</td>
<td align="right">33</td>
<td align="right">0.7575758</td>
</tr>
<tr class="even">
<td align="right">2004</td>
<td align="left">NYA</td>
<td align="right">101</td>
<td align="right">162</td>
<td align="right">18</td>
<td align="right">24</td>
<td align="right">0.7500000</td>
</tr>
<tr class="odd">
<td align="right">2013</td>
<td align="left">CLE</td>
<td align="right">92</td>
<td align="right">162</td>
<td align="right">21</td>
<td align="right">28</td>
<td align="right">0.7500000</td>
</tr>
<tr class="even">
<td align="right">1977</td>
<td align="left">BAL</td>
<td align="right">97</td>
<td align="right">161</td>
<td align="right">26</td>
<td align="right">35</td>
<td align="right">0.7428571</td>
</tr>
<tr class="odd">
<td align="right">2005</td>
<td align="left">PHI</td>
<td align="right">88</td>
<td align="right">162</td>
<td align="right">20</td>
<td align="right">27</td>
<td align="right">0.7407407</td>
</tr>
<tr class="even">
<td align="right">1999</td>
<td align="left">ATL</td>
<td align="right">103</td>
<td align="right">162</td>
<td align="right">28</td>
<td align="right">38</td>
<td align="right">0.7368421</td>
</tr>
<tr class="odd">
<td align="right">1956</td>
<td align="left">BOS</td>
<td align="right">83</td>
<td align="right">152</td>
<td align="right">22</td>
<td align="right">30</td>
<td align="right">0.7333333</td>
</tr>
<tr class="even">
<td align="right">1963</td>
<td align="left">LAN</td>
<td align="right">99</td>
<td align="right">163</td>
<td align="right">22</td>
<td align="right">30</td>
<td align="right">0.7333333</td>
</tr>
<tr class="odd">
<td align="right">1975</td>
<td align="left">TEX</td>
<td align="right">79</td>
<td align="right">162</td>
<td align="right">22</td>
<td align="right">30</td>
<td align="right">0.7333333</td>
</tr>
<tr class="even">
<td align="right">1967</td>
<td align="left">MIN</td>
<td align="right">91</td>
<td align="right">164</td>
<td align="right">19</td>
<td align="right">26</td>
<td align="right">0.7307692</td>
</tr>
<tr class="odd">
<td align="right">1968</td>
<td align="left">SLN</td>
<td align="right">97</td>
<td align="right">162</td>
<td align="right">29</td>
<td align="right">40</td>
<td align="right">0.7250000</td>
</tr>
<tr class="even">
<td align="right">1969</td>
<td align="left">NYN</td>
<td align="right">100</td>
<td align="right">162</td>
<td align="right">31</td>
<td align="right">43</td>
<td align="right">0.7209302</td>
</tr>
</tbody>
</table>
<p>Let’s tighten that up to 10th percentile</p>
<pre class="r"><code>close_definition = 0.1</code></pre>
<pre class="r"><code>close_percentile_df %&gt;% 
  mutate(is_close = c_frac &lt;= close_definition) %&gt;% 
  group_by(year_id, team_id) %&gt;% 
  summarise(w=sum(is_win), g=n(), 
            w_close = sum(is_close * is_win), 
            g_close = sum(is_close), 
            wpct_close = w_close/g_close) %&gt;% 
  arrange(-w_close) %&gt;% head(20) %&gt;% knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">year_id</th>
<th align="left">team_id</th>
<th align="right">w</th>
<th align="right">g</th>
<th align="right">w_close</th>
<th align="right">g_close</th>
<th align="right">wpct_close</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1999</td>
<td align="left">ATL</td>
<td align="right">103</td>
<td align="right">162</td>
<td align="right">20</td>
<td align="right">26</td>
<td align="right">0.7692308</td>
</tr>
<tr class="even">
<td align="right">1974</td>
<td align="left">BAL</td>
<td align="right">91</td>
<td align="right">162</td>
<td align="right">19</td>
<td align="right">25</td>
<td align="right">0.7600000</td>
</tr>
<tr class="odd">
<td align="right">1969</td>
<td align="left">NYN</td>
<td align="right">100</td>
<td align="right">162</td>
<td align="right">18</td>
<td align="right">23</td>
<td align="right">0.7826087</td>
</tr>
<tr class="even">
<td align="right">1996</td>
<td align="left">SDN</td>
<td align="right">91</td>
<td align="right">162</td>
<td align="right">18</td>
<td align="right">26</td>
<td align="right">0.6923077</td>
</tr>
<tr class="odd">
<td align="right">1993</td>
<td align="left">ATL</td>
<td align="right">104</td>
<td align="right">162</td>
<td align="right">17</td>
<td align="right">24</td>
<td align="right">0.7083333</td>
</tr>
<tr class="even">
<td align="right">2002</td>
<td align="left">SFN</td>
<td align="right">95</td>
<td align="right">162</td>
<td align="right">17</td>
<td align="right">25</td>
<td align="right">0.6800000</td>
</tr>
<tr class="odd">
<td align="right">2004</td>
<td align="left">SLN</td>
<td align="right">105</td>
<td align="right">162</td>
<td align="right">17</td>
<td align="right">23</td>
<td align="right">0.7391304</td>
</tr>
<tr class="even">
<td align="right">2009</td>
<td align="left">LAN</td>
<td align="right">95</td>
<td align="right">162</td>
<td align="right">17</td>
<td align="right">28</td>
<td align="right">0.6071429</td>
</tr>
<tr class="odd">
<td align="right">1967</td>
<td align="left">CHA</td>
<td align="right">89</td>
<td align="right">162</td>
<td align="right">16</td>
<td align="right">24</td>
<td align="right">0.6666667</td>
</tr>
<tr class="even">
<td align="right">1970</td>
<td align="left">PHI</td>
<td align="right">73</td>
<td align="right">161</td>
<td align="right">16</td>
<td align="right">23</td>
<td align="right">0.6956522</td>
</tr>
<tr class="odd">
<td align="right">1975</td>
<td align="left">SFN</td>
<td align="right">80</td>
<td align="right">161</td>
<td align="right">16</td>
<td align="right">22</td>
<td align="right">0.7272727</td>
</tr>
<tr class="even">
<td align="right">1980</td>
<td align="left">MON</td>
<td align="right">90</td>
<td align="right">162</td>
<td align="right">16</td>
<td align="right">24</td>
<td align="right">0.6666667</td>
</tr>
<tr class="odd">
<td align="right">1980</td>
<td align="left">SDN</td>
<td align="right">73</td>
<td align="right">163</td>
<td align="right">16</td>
<td align="right">27</td>
<td align="right">0.5925926</td>
</tr>
<tr class="even">
<td align="right">1982</td>
<td align="left">PHI</td>
<td align="right">89</td>
<td align="right">162</td>
<td align="right">16</td>
<td align="right">23</td>
<td align="right">0.6956522</td>
</tr>
<tr class="odd">
<td align="right">1990</td>
<td align="left">BOS</td>
<td align="right">88</td>
<td align="right">162</td>
<td align="right">16</td>
<td align="right">23</td>
<td align="right">0.6956522</td>
</tr>
<tr class="even">
<td align="right">1990</td>
<td align="left">HOU</td>
<td align="right">75</td>
<td align="right">162</td>
<td align="right">16</td>
<td align="right">30</td>
<td align="right">0.5333333</td>
</tr>
<tr class="odd">
<td align="right">1993</td>
<td align="left">SLN</td>
<td align="right">87</td>
<td align="right">162</td>
<td align="right">16</td>
<td align="right">27</td>
<td align="right">0.5925926</td>
</tr>
<tr class="even">
<td align="right">1997</td>
<td align="left">ATL</td>
<td align="right">101</td>
<td align="right">162</td>
<td align="right">16</td>
<td align="right">31</td>
<td align="right">0.5161290</td>
</tr>
<tr class="odd">
<td align="right">1998</td>
<td align="left">LAN</td>
<td align="right">83</td>
<td align="right">162</td>
<td align="right">16</td>
<td align="right">24</td>
<td align="right">0.6666667</td>
</tr>
<tr class="even">
<td align="right">2003</td>
<td align="left">ARI</td>
<td align="right">84</td>
<td align="right">162</td>
<td align="right">16</td>
<td align="right">26</td>
<td align="right">0.6153846</td>
</tr>
</tbody>
</table>
<pre class="r"><code>close_percentile_df %&gt;% 
  mutate(is_close = c_frac &lt;= close_definition) %&gt;% 
  group_by(year_id, team_id) %&gt;% 
  summarise(w=sum(is_win), g=n(), 
            w_close = sum(is_close * is_win), 
            g_close = sum(is_close), 
            wpct_close = w_close/g_close) %&gt;% 
  arrange(-wpct_close) %&gt;% head(20) %&gt;% knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">year_id</th>
<th align="left">team_id</th>
<th align="right">w</th>
<th align="right">g</th>
<th align="right">w_close</th>
<th align="right">g_close</th>
<th align="right">wpct_close</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2009</td>
<td align="left">NYA</td>
<td align="right">103</td>
<td align="right">162</td>
<td align="right">12</td>
<td align="right">13</td>
<td align="right">0.9230769</td>
</tr>
<tr class="even">
<td align="right">2003</td>
<td align="left">SFN</td>
<td align="right">100</td>
<td align="right">161</td>
<td align="right">11</td>
<td align="right">12</td>
<td align="right">0.9166667</td>
</tr>
<tr class="odd">
<td align="right">1968</td>
<td align="left">PHI</td>
<td align="right">76</td>
<td align="right">162</td>
<td align="right">9</td>
<td align="right">10</td>
<td align="right">0.9000000</td>
</tr>
<tr class="even">
<td align="right">2012</td>
<td align="left">BAL</td>
<td align="right">93</td>
<td align="right">162</td>
<td align="right">16</td>
<td align="right">18</td>
<td align="right">0.8888889</td>
</tr>
<tr class="odd">
<td align="right">1999</td>
<td align="left">TEX</td>
<td align="right">95</td>
<td align="right">162</td>
<td align="right">13</td>
<td align="right">15</td>
<td align="right">0.8666667</td>
</tr>
<tr class="even">
<td align="right">1984</td>
<td align="left">NYN</td>
<td align="right">90</td>
<td align="right">162</td>
<td align="right">12</td>
<td align="right">14</td>
<td align="right">0.8571429</td>
</tr>
<tr class="odd">
<td align="right">2006</td>
<td align="left">TOR</td>
<td align="right">87</td>
<td align="right">162</td>
<td align="right">6</td>
<td align="right">7</td>
<td align="right">0.8571429</td>
</tr>
<tr class="even">
<td align="right">1998</td>
<td align="left">HOU</td>
<td align="right">102</td>
<td align="right">162</td>
<td align="right">11</td>
<td align="right">13</td>
<td align="right">0.8461538</td>
</tr>
<tr class="odd">
<td align="right">1988</td>
<td align="left">OAK</td>
<td align="right">104</td>
<td align="right">162</td>
<td align="right">15</td>
<td align="right">18</td>
<td align="right">0.8333333</td>
</tr>
<tr class="even">
<td align="right">1995</td>
<td align="left">ATL</td>
<td align="right">90</td>
<td align="right">144</td>
<td align="right">15</td>
<td align="right">18</td>
<td align="right">0.8333333</td>
</tr>
<tr class="odd">
<td align="right">1996</td>
<td align="left">MIL</td>
<td align="right">80</td>
<td align="right">162</td>
<td align="right">10</td>
<td align="right">12</td>
<td align="right">0.8333333</td>
</tr>
<tr class="even">
<td align="right">2000</td>
<td align="left">OAK</td>
<td align="right">91</td>
<td align="right">161</td>
<td align="right">5</td>
<td align="right">6</td>
<td align="right">0.8333333</td>
</tr>
<tr class="odd">
<td align="right">2013</td>
<td align="left">ATL</td>
<td align="right">96</td>
<td align="right">162</td>
<td align="right">10</td>
<td align="right">12</td>
<td align="right">0.8333333</td>
</tr>
<tr class="even">
<td align="right">2017</td>
<td align="left">WAS</td>
<td align="right">97</td>
<td align="right">162</td>
<td align="right">15</td>
<td align="right">18</td>
<td align="right">0.8333333</td>
</tr>
<tr class="odd">
<td align="right">1989</td>
<td align="left">SDN</td>
<td align="right">89</td>
<td align="right">162</td>
<td align="right">14</td>
<td align="right">17</td>
<td align="right">0.8235294</td>
</tr>
<tr class="even">
<td align="right">1977</td>
<td align="left">SFN</td>
<td align="right">75</td>
<td align="right">162</td>
<td align="right">9</td>
<td align="right">11</td>
<td align="right">0.8181818</td>
</tr>
<tr class="odd">
<td align="right">1990</td>
<td align="left">CHN</td>
<td align="right">77</td>
<td align="right">162</td>
<td align="right">9</td>
<td align="right">11</td>
<td align="right">0.8181818</td>
</tr>
<tr class="even">
<td align="right">1995</td>
<td align="left">CLE</td>
<td align="right">100</td>
<td align="right">144</td>
<td align="right">9</td>
<td align="right">11</td>
<td align="right">0.8181818</td>
</tr>
<tr class="odd">
<td align="right">1981</td>
<td align="left">CIN</td>
<td align="right">66</td>
<td align="right">108</td>
<td align="right">8</td>
<td align="right">10</td>
<td align="right">0.8000000</td>
</tr>
<tr class="even">
<td align="right">1981</td>
<td align="left">TEX</td>
<td align="right">57</td>
<td align="right">105</td>
<td align="right">4</td>
<td align="right">5</td>
<td align="right">0.8000000</td>
</tr>
</tbody>
</table>
<p>Let’s try looking at blowouts</p>
<pre class="r"><code>blowout_definition = 0.8</code></pre>
<pre class="r"><code>close_percentile_df %&gt;% 
  mutate(is_blowout = c_frac &gt;= blowout_definition) %&gt;% 
  group_by(year_id, team_id) %&gt;% 
  summarise(w=sum(is_win), g=n(), 
            w_blowout = sum(is_blowout * is_win), 
            g_blowout = sum(is_blowout), 
            wpct_blowout = w_blowout/g_blowout) %&gt;% 
  arrange(-w_blowout) %&gt;% head(20) %&gt;% knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">year_id</th>
<th align="left">team_id</th>
<th align="right">w</th>
<th align="right">g</th>
<th align="right">w_blowout</th>
<th align="right">g_blowout</th>
<th align="right">wpct_blowout</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2015</td>
<td align="left">TOR</td>
<td align="right">93</td>
<td align="right">162</td>
<td align="right">33</td>
<td align="right">47</td>
<td align="right">0.7021277</td>
</tr>
<tr class="even">
<td align="right">1983</td>
<td align="left">BAL</td>
<td align="right">98</td>
<td align="right">162</td>
<td align="right">32</td>
<td align="right">51</td>
<td align="right">0.6274510</td>
</tr>
<tr class="odd">
<td align="right">1985</td>
<td align="left">NYA</td>
<td align="right">97</td>
<td align="right">161</td>
<td align="right">32</td>
<td align="right">43</td>
<td align="right">0.7441860</td>
</tr>
<tr class="even">
<td align="right">1956</td>
<td align="left">NYA</td>
<td align="right">97</td>
<td align="right">154</td>
<td align="right">31</td>
<td align="right">47</td>
<td align="right">0.6595745</td>
</tr>
<tr class="odd">
<td align="right">1962</td>
<td align="left">SFN</td>
<td align="right">103</td>
<td align="right">165</td>
<td align="right">31</td>
<td align="right">44</td>
<td align="right">0.7045455</td>
</tr>
<tr class="even">
<td align="right">1970</td>
<td align="left">CHN</td>
<td align="right">84</td>
<td align="right">162</td>
<td align="right">31</td>
<td align="right">41</td>
<td align="right">0.7560976</td>
</tr>
<tr class="odd">
<td align="right">1987</td>
<td align="left">DET</td>
<td align="right">98</td>
<td align="right">162</td>
<td align="right">31</td>
<td align="right">47</td>
<td align="right">0.6595745</td>
</tr>
<tr class="even">
<td align="right">2002</td>
<td align="left">ANA</td>
<td align="right">99</td>
<td align="right">162</td>
<td align="right">31</td>
<td align="right">39</td>
<td align="right">0.7948718</td>
</tr>
<tr class="odd">
<td align="right">1977</td>
<td align="left">NYA</td>
<td align="right">100</td>
<td align="right">162</td>
<td align="right">30</td>
<td align="right">44</td>
<td align="right">0.6818182</td>
</tr>
<tr class="even">
<td align="right">1979</td>
<td align="left">BOS</td>
<td align="right">91</td>
<td align="right">160</td>
<td align="right">30</td>
<td align="right">44</td>
<td align="right">0.6818182</td>
</tr>
<tr class="odd">
<td align="right">1980</td>
<td align="left">KCA</td>
<td align="right">97</td>
<td align="right">162</td>
<td align="right">30</td>
<td align="right">47</td>
<td align="right">0.6382979</td>
</tr>
<tr class="even">
<td align="right">1998</td>
<td align="left">NYA</td>
<td align="right">114</td>
<td align="right">162</td>
<td align="right">30</td>
<td align="right">39</td>
<td align="right">0.7692308</td>
</tr>
<tr class="odd">
<td align="right">1976</td>
<td align="left">CIN</td>
<td align="right">102</td>
<td align="right">162</td>
<td align="right">29</td>
<td align="right">39</td>
<td align="right">0.7435897</td>
</tr>
<tr class="even">
<td align="right">1988</td>
<td align="left">TOR</td>
<td align="right">87</td>
<td align="right">162</td>
<td align="right">29</td>
<td align="right">45</td>
<td align="right">0.6444444</td>
</tr>
<tr class="odd">
<td align="right">1998</td>
<td align="left">HOU</td>
<td align="right">102</td>
<td align="right">162</td>
<td align="right">29</td>
<td align="right">35</td>
<td align="right">0.8285714</td>
</tr>
<tr class="even">
<td align="right">1999</td>
<td align="left">CLE</td>
<td align="right">97</td>
<td align="right">162</td>
<td align="right">29</td>
<td align="right">42</td>
<td align="right">0.6904762</td>
</tr>
<tr class="odd">
<td align="right">2003</td>
<td align="left">NYA</td>
<td align="right">101</td>
<td align="right">163</td>
<td align="right">29</td>
<td align="right">42</td>
<td align="right">0.6904762</td>
</tr>
<tr class="even">
<td align="right">1955</td>
<td align="left">NYA</td>
<td align="right">96</td>
<td align="right">154</td>
<td align="right">28</td>
<td align="right">37</td>
<td align="right">0.7567568</td>
</tr>
<tr class="odd">
<td align="right">1961</td>
<td align="left">DET</td>
<td align="right">101</td>
<td align="right">163</td>
<td align="right">28</td>
<td align="right">41</td>
<td align="right">0.6829268</td>
</tr>
<tr class="even">
<td align="right">1962</td>
<td align="left">LAN</td>
<td align="right">102</td>
<td align="right">165</td>
<td align="right">28</td>
<td align="right">47</td>
<td align="right">0.5957447</td>
</tr>
</tbody>
</table>
<pre class="r"><code>close_percentile_df %&gt;% 
  mutate(is_blowout = c_frac &gt;= blowout_definition) %&gt;% 
  group_by(year_id, team_id) %&gt;% 
  summarise(w=sum(is_win), g=n(), 
            w_blowout = sum(is_blowout * is_win), 
            g_blowout = sum(is_blowout), 
            wpct_blowout = w_blowout/g_blowout) %&gt;% 
  arrange(-wpct_blowout) %&gt;% head(20) %&gt;% knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">year_id</th>
<th align="left">team_id</th>
<th align="right">w</th>
<th align="right">g</th>
<th align="right">w_blowout</th>
<th align="right">g_blowout</th>
<th align="right">wpct_blowout</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2017</td>
<td align="left">CLE</td>
<td align="right">102</td>
<td align="right">162</td>
<td align="right">28</td>
<td align="right">32</td>
<td align="right">0.8750000</td>
</tr>
<tr class="even">
<td align="right">1999</td>
<td align="left">ARI</td>
<td align="right">100</td>
<td align="right">162</td>
<td align="right">20</td>
<td align="right">23</td>
<td align="right">0.8695652</td>
</tr>
<tr class="odd">
<td align="right">1969</td>
<td align="left">BAL</td>
<td align="right">109</td>
<td align="right">162</td>
<td align="right">27</td>
<td align="right">32</td>
<td align="right">0.8437500</td>
</tr>
<tr class="even">
<td align="right">1994</td>
<td align="left">ATL</td>
<td align="right">68</td>
<td align="right">114</td>
<td align="right">15</td>
<td align="right">18</td>
<td align="right">0.8333333</td>
</tr>
<tr class="odd">
<td align="right">1998</td>
<td align="left">HOU</td>
<td align="right">102</td>
<td align="right">162</td>
<td align="right">29</td>
<td align="right">35</td>
<td align="right">0.8285714</td>
</tr>
<tr class="even">
<td align="right">2012</td>
<td align="left">TBA</td>
<td align="right">90</td>
<td align="right">162</td>
<td align="right">22</td>
<td align="right">27</td>
<td align="right">0.8148148</td>
</tr>
<tr class="odd">
<td align="right">1971</td>
<td align="left">BAL</td>
<td align="right">101</td>
<td align="right">158</td>
<td align="right">26</td>
<td align="right">32</td>
<td align="right">0.8125000</td>
</tr>
<tr class="even">
<td align="right">1990</td>
<td align="left">PIT</td>
<td align="right">95</td>
<td align="right">162</td>
<td align="right">26</td>
<td align="right">32</td>
<td align="right">0.8125000</td>
</tr>
<tr class="odd">
<td align="right">2012</td>
<td align="left">ATL</td>
<td align="right">94</td>
<td align="right">162</td>
<td align="right">25</td>
<td align="right">31</td>
<td align="right">0.8064516</td>
</tr>
<tr class="even">
<td align="right">2008</td>
<td align="left">CHN</td>
<td align="right">97</td>
<td align="right">161</td>
<td align="right">24</td>
<td align="right">30</td>
<td align="right">0.8000000</td>
</tr>
<tr class="odd">
<td align="right">2016</td>
<td align="left">CHN</td>
<td align="right">103</td>
<td align="right">162</td>
<td align="right">24</td>
<td align="right">30</td>
<td align="right">0.8000000</td>
</tr>
<tr class="even">
<td align="right">2002</td>
<td align="left">ANA</td>
<td align="right">99</td>
<td align="right">162</td>
<td align="right">31</td>
<td align="right">39</td>
<td align="right">0.7948718</td>
</tr>
<tr class="odd">
<td align="right">1976</td>
<td align="left">PHI</td>
<td align="right">101</td>
<td align="right">162</td>
<td align="right">25</td>
<td align="right">32</td>
<td align="right">0.7812500</td>
</tr>
<tr class="even">
<td align="right">1979</td>
<td align="left">BAL</td>
<td align="right">102</td>
<td align="right">159</td>
<td align="right">21</td>
<td align="right">27</td>
<td align="right">0.7777778</td>
</tr>
<tr class="odd">
<td align="right">1997</td>
<td align="left">ATL</td>
<td align="right">101</td>
<td align="right">162</td>
<td align="right">21</td>
<td align="right">27</td>
<td align="right">0.7777778</td>
</tr>
<tr class="even">
<td align="right">1960</td>
<td align="left">CHA</td>
<td align="right">87</td>
<td align="right">154</td>
<td align="right">24</td>
<td align="right">31</td>
<td align="right">0.7741935</td>
</tr>
<tr class="odd">
<td align="right">1977</td>
<td align="left">LAN</td>
<td align="right">98</td>
<td align="right">162</td>
<td align="right">24</td>
<td align="right">31</td>
<td align="right">0.7741935</td>
</tr>
<tr class="even">
<td align="right">1996</td>
<td align="left">SEA</td>
<td align="right">85</td>
<td align="right">161</td>
<td align="right">24</td>
<td align="right">31</td>
<td align="right">0.7741935</td>
</tr>
<tr class="odd">
<td align="right">2016</td>
<td align="left">BOS</td>
<td align="right">93</td>
<td align="right">162</td>
<td align="right">27</td>
<td align="right">35</td>
<td align="right">0.7714286</td>
</tr>
<tr class="even">
<td align="right">1970</td>
<td align="left">MIN</td>
<td align="right">98</td>
<td align="right">162</td>
<td align="right">20</td>
<td align="right">26</td>
<td align="right">0.7692308</td>
</tr>
</tbody>
</table>
<p>Rachet it up to 90th percentile</p>
<pre class="r"><code>blowout_definition = 0.9</code></pre>
<pre class="r"><code>close_percentile_df %&gt;% 
  mutate(is_blowout = c_frac &gt;= blowout_definition) %&gt;% 
  group_by(year_id, team_id) %&gt;% 
  summarise(w=sum(is_win), g=n(), 
            w_blowout = sum(is_blowout * is_win), 
            g_blowout = sum(is_blowout), 
            wpct_blowout = w_blowout/g_blowout) %&gt;% 
  arrange(-w_blowout) %&gt;% head(20) %&gt;% knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">year_id</th>
<th align="left">team_id</th>
<th align="right">w</th>
<th align="right">g</th>
<th align="right">w_blowout</th>
<th align="right">g_blowout</th>
<th align="right">wpct_blowout</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1987</td>
<td align="left">DET</td>
<td align="right">98</td>
<td align="right">162</td>
<td align="right">24</td>
<td align="right">31</td>
<td align="right">0.7741935</td>
</tr>
<tr class="even">
<td align="right">1977</td>
<td align="left">NYA</td>
<td align="right">100</td>
<td align="right">162</td>
<td align="right">21</td>
<td align="right">25</td>
<td align="right">0.8400000</td>
</tr>
<tr class="odd">
<td align="right">2014</td>
<td align="left">OAK</td>
<td align="right">88</td>
<td align="right">162</td>
<td align="right">21</td>
<td align="right">26</td>
<td align="right">0.8076923</td>
</tr>
<tr class="even">
<td align="right">2011</td>
<td align="left">TEX</td>
<td align="right">96</td>
<td align="right">162</td>
<td align="right">19</td>
<td align="right">30</td>
<td align="right">0.6333333</td>
</tr>
<tr class="odd">
<td align="right">2013</td>
<td align="left">SLN</td>
<td align="right">97</td>
<td align="right">162</td>
<td align="right">19</td>
<td align="right">24</td>
<td align="right">0.7916667</td>
</tr>
<tr class="even">
<td align="right">2015</td>
<td align="left">TOR</td>
<td align="right">93</td>
<td align="right">162</td>
<td align="right">19</td>
<td align="right">23</td>
<td align="right">0.8260870</td>
</tr>
<tr class="odd">
<td align="right">1969</td>
<td align="left">MIN</td>
<td align="right">97</td>
<td align="right">162</td>
<td align="right">18</td>
<td align="right">23</td>
<td align="right">0.7826087</td>
</tr>
<tr class="even">
<td align="right">1970</td>
<td align="left">BAL</td>
<td align="right">108</td>
<td align="right">162</td>
<td align="right">18</td>
<td align="right">23</td>
<td align="right">0.7826087</td>
</tr>
<tr class="odd">
<td align="right">1980</td>
<td align="left">KCA</td>
<td align="right">97</td>
<td align="right">162</td>
<td align="right">18</td>
<td align="right">26</td>
<td align="right">0.6923077</td>
</tr>
<tr class="even">
<td align="right">1986</td>
<td align="left">BOS</td>
<td align="right">95</td>
<td align="right">161</td>
<td align="right">18</td>
<td align="right">19</td>
<td align="right">0.9473684</td>
</tr>
<tr class="odd">
<td align="right">1992</td>
<td align="left">MIL</td>
<td align="right">92</td>
<td align="right">162</td>
<td align="right">18</td>
<td align="right">25</td>
<td align="right">0.7200000</td>
</tr>
<tr class="even">
<td align="right">1992</td>
<td align="left">TOR</td>
<td align="right">96</td>
<td align="right">162</td>
<td align="right">18</td>
<td align="right">28</td>
<td align="right">0.6428571</td>
</tr>
<tr class="odd">
<td align="right">1995</td>
<td align="left">CAL</td>
<td align="right">78</td>
<td align="right">145</td>
<td align="right">18</td>
<td align="right">25</td>
<td align="right">0.7200000</td>
</tr>
<tr class="even">
<td align="right">1998</td>
<td align="left">NYA</td>
<td align="right">114</td>
<td align="right">162</td>
<td align="right">18</td>
<td align="right">22</td>
<td align="right">0.8181818</td>
</tr>
<tr class="odd">
<td align="right">2013</td>
<td align="left">DET</td>
<td align="right">93</td>
<td align="right">162</td>
<td align="right">18</td>
<td align="right">21</td>
<td align="right">0.8571429</td>
</tr>
<tr class="even">
<td align="right">1956</td>
<td align="left">NYA</td>
<td align="right">97</td>
<td align="right">154</td>
<td align="right">17</td>
<td align="right">23</td>
<td align="right">0.7391304</td>
</tr>
<tr class="odd">
<td align="right">1982</td>
<td align="left">CAL</td>
<td align="right">93</td>
<td align="right">162</td>
<td align="right">17</td>
<td align="right">17</td>
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="right">1983</td>
<td align="left">DET</td>
<td align="right">92</td>
<td align="right">162</td>
<td align="right">17</td>
<td align="right">25</td>
<td align="right">0.6800000</td>
</tr>
<tr class="odd">
<td align="right">1985</td>
<td align="left">NYA</td>
<td align="right">97</td>
<td align="right">161</td>
<td align="right">17</td>
<td align="right">24</td>
<td align="right">0.7083333</td>
</tr>
<tr class="even">
<td align="right">2002</td>
<td align="left">BOS</td>
<td align="right">93</td>
<td align="right">162</td>
<td align="right">17</td>
<td align="right">19</td>
<td align="right">0.8947368</td>
</tr>
</tbody>
</table>
<pre class="r"><code>close_percentile_df %&gt;% 
  mutate(is_blowout = c_frac &gt;= blowout_definition) %&gt;% 
  group_by(year_id, team_id) %&gt;% 
  summarise(w=sum(is_win), g=n(), 
            w_blowout = sum(is_blowout * is_win), 
            g_blowout = sum(is_blowout), 
            wpct_blowout = w_blowout/g_blowout) %&gt;% 
  arrange(-wpct_blowout) %&gt;% head(20) %&gt;% knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">year_id</th>
<th align="left">team_id</th>
<th align="right">w</th>
<th align="right">g</th>
<th align="right">w_blowout</th>
<th align="right">g_blowout</th>
<th align="right">wpct_blowout</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1966</td>
<td align="left">BAL</td>
<td align="right">97</td>
<td align="right">160</td>
<td align="right">11</td>
<td align="right">11</td>
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="right">1977</td>
<td align="left">KCA</td>
<td align="right">102</td>
<td align="right">162</td>
<td align="right">12</td>
<td align="right">12</td>
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="right">1982</td>
<td align="left">CAL</td>
<td align="right">93</td>
<td align="right">162</td>
<td align="right">17</td>
<td align="right">17</td>
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="right">1994</td>
<td align="left">PHI</td>
<td align="right">54</td>
<td align="right">115</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="right">1986</td>
<td align="left">BOS</td>
<td align="right">95</td>
<td align="right">161</td>
<td align="right">18</td>
<td align="right">19</td>
<td align="right">0.9473684</td>
</tr>
<tr class="even">
<td align="right">1998</td>
<td align="left">HOU</td>
<td align="right">102</td>
<td align="right">162</td>
<td align="right">16</td>
<td align="right">17</td>
<td align="right">0.9411765</td>
</tr>
<tr class="odd">
<td align="right">2017</td>
<td align="left">CLE</td>
<td align="right">102</td>
<td align="right">162</td>
<td align="right">16</td>
<td align="right">17</td>
<td align="right">0.9411765</td>
</tr>
<tr class="even">
<td align="right">1969</td>
<td align="left">BAL</td>
<td align="right">109</td>
<td align="right">162</td>
<td align="right">15</td>
<td align="right">16</td>
<td align="right">0.9375000</td>
</tr>
<tr class="odd">
<td align="right">1995</td>
<td align="left">CLE</td>
<td align="right">100</td>
<td align="right">144</td>
<td align="right">14</td>
<td align="right">15</td>
<td align="right">0.9333333</td>
</tr>
<tr class="even">
<td align="right">1991</td>
<td align="left">PIT</td>
<td align="right">98</td>
<td align="right">162</td>
<td align="right">12</td>
<td align="right">13</td>
<td align="right">0.9230769</td>
</tr>
<tr class="odd">
<td align="right">1960</td>
<td align="left">DET</td>
<td align="right">71</td>
<td align="right">154</td>
<td align="right">11</td>
<td align="right">12</td>
<td align="right">0.9166667</td>
</tr>
<tr class="even">
<td align="right">1986</td>
<td align="left">NYN</td>
<td align="right">108</td>
<td align="right">162</td>
<td align="right">11</td>
<td align="right">12</td>
<td align="right">0.9166667</td>
</tr>
<tr class="odd">
<td align="right">2009</td>
<td align="left">PHI</td>
<td align="right">93</td>
<td align="right">162</td>
<td align="right">11</td>
<td align="right">12</td>
<td align="right">0.9166667</td>
</tr>
<tr class="even">
<td align="right">2002</td>
<td align="left">BOS</td>
<td align="right">93</td>
<td align="right">162</td>
<td align="right">17</td>
<td align="right">19</td>
<td align="right">0.8947368</td>
</tr>
<tr class="odd">
<td align="right">1984</td>
<td align="left">MON</td>
<td align="right">78</td>
<td align="right">161</td>
<td align="right">7</td>
<td align="right">8</td>
<td align="right">0.8750000</td>
</tr>
<tr class="even">
<td align="right">2012</td>
<td align="left">TBA</td>
<td align="right">90</td>
<td align="right">162</td>
<td align="right">14</td>
<td align="right">16</td>
<td align="right">0.8750000</td>
</tr>
<tr class="odd">
<td align="right">2017</td>
<td align="left">NYA</td>
<td align="right">91</td>
<td align="right">162</td>
<td align="right">14</td>
<td align="right">16</td>
<td align="right">0.8750000</td>
</tr>
<tr class="even">
<td align="right">1974</td>
<td align="left">LAN</td>
<td align="right">102</td>
<td align="right">162</td>
<td align="right">13</td>
<td align="right">15</td>
<td align="right">0.8666667</td>
</tr>
<tr class="odd">
<td align="right">1976</td>
<td align="left">PHI</td>
<td align="right">101</td>
<td align="right">162</td>
<td align="right">13</td>
<td align="right">15</td>
<td align="right">0.8666667</td>
</tr>
<tr class="even">
<td align="right">1979</td>
<td align="left">BAL</td>
<td align="right">102</td>
<td align="right">159</td>
<td align="right">13</td>
<td align="right">15</td>
<td align="right">0.8666667</td>
</tr>
</tbody>
</table>
<pre class="r"><code>close_definition = 0.2

plot_df = close_percentile_df %&gt;% 
  mutate(is_close = c_frac &lt;= close_definition) %&gt;% 
  group_by(year_id, team_id) %&gt;% 
  summarise(w=sum(is_win), g=n(), 
            w_close = sum(is_close * is_win), 
            g_close = sum(is_close), 
            wpct_close = w_close/g_close, 
            wpct_other = (w-w_close)/(g - g_close)) %&gt;% 
  ungroup()</code></pre>
<pre class="r"><code>p = plot_df %&gt;% 
  ggplot(aes(x=wpct_other, y=wpct_close)) + 
  geom_point() + 
  theme_minimal(base_size = 16) + 
  geom_hline(yintercept = 0.5, size=0.5, color=&#39;steelblue&#39;) + 
  geom_vline(xintercept = 0.5, size=0.5, color=&#39;steelblue&#39;) + 
  labs(x=&quot;Win Pct. - Non close games&quot;, y=&quot;Win Pct. - close games&quot;)
print(p)</code></pre>
<p><img src="2018-06-17-closeness-index-one-run-games_files/figure-html/unnamed-chunk-30-1.png" width="768" /></p>
<p>Label the ones that are on the edges</p>
<pre class="r"><code>records_quads = plot_df %&gt;% 
  mutate(r2=(wpct_other - 0.5)**2 + (wpct_close - 0.5)**2, 
         quad=as.integer(wpct_other &gt;= 0.5) + 2 * as.integer(wpct_close &gt;= 0.5))</code></pre>
<pre class="r"><code>lab_df = records_quads %&gt;% 
  group_by(quad) %&gt;% 
  arrange(-r2) %&gt;% 
  mutate(r2_rank=row_number()) %&gt;% 
  filter(r2_rank &lt;= 10) %&gt;% 
  ungroup() %&gt;% 
  mutate(name=paste(team_id, year_id))</code></pre>
<pre class="r"><code>p2 = p + 
  geom_text_repel(data = lab_df, aes(x=wpct_other, y=wpct_close, label=name))
print(p2)</code></pre>
<p><img src="2018-06-17-closeness-index-one-run-games_files/figure-html/unnamed-chunk-33-1.png" width="768" /></p>
</div>
